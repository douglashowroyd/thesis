\chapter{Other results}
\label{chap:other}

In Chapter \ref{chap:motzkin} we classified the congruences of the Motzkin
monoid and several related diagram monoids.  This classification was achieved by
first calculating the congruence lattices for small values of $n$ using the
computational techniques described in Chapters \ref{chap:pairs} and
\ref{chap:lattice}, and then building up theory in order to prove a
classification for general $n$.  In this chapter we present some more results
about congruences that were obtained in a similar way, by first looking for
patterns in computational results, and then extending the results and attempting
to prove them for larger semigroups.  The \texttt{libsemigroups} library and the
Semigroups and \texttt{smallsemi} packages for GAP were used to carry out the
initial computations \cite{libsemigroups, semigroups, smallsemi, gap}.

\section{Congruences of principal factors}
\label{sec:princfact}

In this section, we will consider an interesting decomposition of a semigroup
related to its $\jJ$-classes $\JJ$-classes: a semigroup's \textit{principal
  factors}.  After defining this construction, we will consider the principal
factors of the full transformation monoid $\T_n$, and classify their
congruences.
After this, we will look at the principal factors of some other, somewhat
similar monoids, and classify their congruences using similar principles.

\subsection{Principal factors}
\label{sec:princfact-def}

Recall that a semigroup's $\JJ$-classes have a natural partial order $\leq$,
defined by the rule that $J_a \leq J_b$ if and only if
$S^1 J_a S^1 \subseteq S^1 J_b S^1$.  For finite semigroups we have $\jJ=\dD$,
and this partial order is shown on eggbox diagrams by the placement of
$\DD$-classes above and below each other, as in Figure \ref{fig:eggbox-diagram}.
Given a $\JJ$-class $J$ of a semigroup $S$, we can define the ideal generated by
$J$, which is given by $S^1 J S^1$.  If $J$ is not minimal, we can also define
the ideal of all $\JJ$-classes below $J$, which is given by
$S^1 J S^1 \setminus J$.  This allows us to make the following definition.

\begin{definition}
  \label{def:princfact}
  \index{principal factor}
  \nomenclature[-]{$\pf{\phantom{D}}$}{Principal factor}
  Let $S$ be a semigroup, and let $J$ be a $\JJ$-class of $S$.  The
  \textbf{principal factor} of $J$ is denoted by $\pf{J}$, and defined as
  follows:
  \begin{itemize}
  \item $\pf{J} = J$ if $J$ is the minimal ideal;
  \item $\pf{J} = S^1 J S^1 / (S^1 J S^1 \setminus J)$ otherwise.
  \end{itemize}
\end{definition}

We will identify a principal factor $\pf{J}$ as the set $J \cup \{0\}$, with
multiplication $\circ$ defined by
$$a \circ b = \left\{
  \begin{array}{l l}
    ab & \text{if~} a,b \in J; \\
    0 & \text{otherwise}.
  \end{array}\right.$$
In the case that $J$ is the minimal ideal of $S$, we do not need to append a
zero.

Since $\pf{J}$ is composed of a single $\JJ$-class, possibly with a zero appended,
it is a simple or 0-simple semigroup.  Hence, if $S$ is finite, we may also
identify $\pf{J}$ with a Rees matrix semigroup $\mathcal{M}[G;I,\Lambda;P]$ or Rees
0-matrix semigroup $\mathcal{M}^0[G;I,\Lambda;P]$, by the Rees Theorem (Theorem
\ref{thm:rees}).  This will help us to classify its congruences later.

\subsection{Full transformation monoid $\T_n$}
\label{sec:princfact-tn}

Now we will consider the principal factors of an important monoid, the full
transformation monoid $\T_n$.  Recall that $\T_n$ is the semigroup consisting of
all transformations on the set $\{1, \dots, n\}$, for some $n \in \mathbb{N}$
(Definition \ref{def:tn}).  In order to describe the principal factors of
$\T_n$, we must first consider its Green's relations, as follows.

\begin{proposition}
  \label{prop:tn-greens}
  Let $n \in \mathbb{N}$, and let $\T_n$ be the full transformation monoid of
  degree $n$.  For two mappings $\alpha, \beta \in \T_n$, the following hold:
  \begin{itemize}
  \item $\alpha \LL \beta$ if and only if $\im \alpha = \im \beta$,
  \item $\alpha \RR \beta$ if and only if $\ker \alpha = \ker \beta$,
  \item $\alpha \DD \beta$ if and only if $\rank \alpha = \rank \beta$.
  \end{itemize}
  % TODO: prove this myself
\end{proposition}

The last part of the above proposition allows us to name the semigroup's
$\DD$-classes $D_1^n, D_2^n, \dots, D_n^n$, where each $D_k^n$ is the
$\DD$-class of $\T_n$ consisting of transformations with rank $k$.  Then the
usual partial ordering of $\JJ$-classes (which in a finite semigroup are the
same as $\DD$-classes) gives $D_1^n < D_2^n < \dots < D_n^n$.

Inside a given $\DD$-class $D_k^n$, elements are divided into $\LL$-classes
according to their image set; since all elements have rank $k$, their images
must have size $k$, and so there are $\binom{n}{k}$ $\LL$-classes in total.
Similarly, the elements of $D_k^n$ are divided into $\RR$-classes according to
their kernel; the possible kernels are all $k$-partitions of an $n$-set, so the
total number of $\RR$-classes is given by the Stirling number of the second
kind, $S(n,k)$ \citeoeis{A008277}.

Each $\HH$-class in $D_k^n$ is the intersection of an $\LL$-class and an
$\RR$-class, so each one corresponds to an image-kernel pair (hence we will talk
about the \textit{image and kernel of an $\HH$-class}).  For a given kernel with
$k$ classes and a given image with $k$ elements, there are $k!$ different ways
to assign image elements to kernel classes, simply the permutations of the set
$\{1, \dots, k\}$.  Hence there are $k!$ elements in each $\HH$-class.

\subsubsection{Group $\HH$-classes of $\T_n$}
To understand the principal factor corresponding to a $\DD$-class $D_k^n$, we need
to understand which of its $\HH$-classes are groups and whcih are not.  To
determine which $\HH$-classes are groups, we recall that in any semigroup an
$\HH$-class H is a group if and only if it contains an idempotent (an element
$\alpha \in H$ such that $\alpha \alpha = \alpha$).  A transformation
$\alpha \in \T_n$ is an idempotent if and only if each point in its image is
mapped by $\alpha$ to itself, i.e.
$$i \alpha = i \quad (\forall i \in \im \alpha).$$
Given an image and a kernel, we can choose a transformation with this condition
if and only if no pair of points in the image are in the same kernel-class---
that is, each image point is in a different kernel-class.  Hence an $\HH$-class
of $D_k^n$ is a group if and only if its image contains one point from each class
of its kernel (i.e.~its image is a \textit{cross-section} of its kernel).
\index{cross-section}

\begin{lemma}
  \label{lem:dk-hclasses}
  Let $k,n \in \mathbb{N}$ with $k \leq n$, and let $D_k^n$ be the $\DD$-class
  of $\T_n$ consisting of the elements of rank $k$.  The following hold:
  \begin{enumerate}[\rm(1)]
  \item For any two distinct $\RR$-classes $R_1$ and $R_2$ of $D_k^n$ there is an
    $\LL$-class $L$ such that $L \cap R_1$ is a group $\HH$-class, but
    $L \cap R_2$ is not.
  \item If $k > 1$, then for any two distinct $\LL$-classes $L_1$ and $L_2$ of
    $D_k^n$ there is an $\RR$-class $R$ such that $L_1 \cap R$ is a group
    $\HH$-class, but $L_2 \cap R$ is not.
  \end{enumerate}
  \begin{proof}
    For (1), let $R_1$ and $R_2$ be distinct $\RR$-classes of $D_k^n$.  These two
    classes correspond to distinct kernels $P_1$ and $P_2$, each partitioning
    $\{1, \dots, n\}$ into $k$ classes.  If $k=n$ then there is only one
    possible partition, $\big\{\{1\}, \dots, \{n\}\big\}$, and so $R_1$ and
    $R_2$ cannot be distinct.  If $k<n$ then there must be a pair of elements
    $i,j \in \{1,\dots, n\}$ which are in different classes of $P_1$ but the
    same class of $P_2$.  Let $X$ be a $k$-set containing one element from each
    class of $P_1$, including $i$ and $j$ -- clearly it is a cross-section of
    $P_1$.  But now $X$ contains two elements from one class of $P_2$, so it is
    not a cross-section of $P_2$.  Hence, if $L$ is the $\LL$-class
    corresponding to image $X$, $L \cap R_1$ is a group $\HH$-class but
    $L \cap R_2$ is not a group $\HH$-class.

    For (2), let $L_1$ and $L_2$ be distinct $\LL$-classes of $D_k^n$, with
    $1 < k \leq n$.  These two classes correspond to distinct images of size $k$
    in $\{1 \dots n\}$; let us call these images $I_1$ and $I_2$ respectively.
    Without loss of generality, let $I_1 = \{1, 2, \dots, k\}$.  Since
    $I_1 \neq I_2$, there must be an element $i \in \{1 \dots k\}$ not in $I_2$.
    Now consider the $k$-partition $P$ which puts each element from
    $\{1 \dots k\}$ in a class on its own, apart from one element
    $j \in \{1 \dots k\}$ not equal to $i$, which is in a class with all the
    elements $\{k+1 \dots n\}$ (choosing $j \neq i$ requires $k > 1$).  Now
    $I_1$ is a cross-section of $P$, having precisely one element from each
    class; but $I_2$ does not have an element from the class $\{i\}$, and so it
    is not a cross-section of $P$.  Let $R$ be the $\RR$-class with kernel $P$,
    and we have that $L_1 \cap R$ is a group $\HH$-class but $L_2 \cap R$ is
    not.
  \end{proof}
\end{lemma}

\subsubsection{Principal factors of $\T_n$}
As mentioned in Section \ref{sec:princfact-def}, any principal factor is either
simple or 0-simple, and so it can be identified with a Rees matrix semigroup or
Rees 0-matrix semigroup.  Hence, for some $k > 1$, let
$\pf{D_k^n} = \mathcal{M}^0[G;I,\Lambda;P]$.  The rows and columns of the matrix
$P$ correspond respectively to the $\LL$-classes and $\RR$-classes of $D_k^n$,
and $G$ is the group isomorphic to each of the group $\HH$-classes of $D_k^n$.
Since the elements of an $\HH$-class here correspond to all the permutations of
its image (all the different ways to assign the $k$ image points to the $k$
classes of the kernel) this group is isomorphic to the symmetric group $S_k$.

To consider the congruences of $\pf{D_k^n}$, we first recognise the universal
congruence $\nabla_{\pf{D_k^n}}$.  All the other congruences are in bijective
correspondence with the linked triples of $\pf{D_k^n}$.  Recall the definition
of a linked triples $(N,\mathcal{S},\mathcal{T})$, from Definition
\ref{def:linked-triple}---that is, a normal subgroup $N \trianglelefteq G$, an
equivalence relation $\mathcal{S}$ on $I$ and an equivalence relation
$\mathcal{T}$ on $\Lambda$, such that the following are satisfied:
\begin{enumerate}[\rm(1)]
\item $\mathcal{S} \subseteq \varepsilon_I$, where
  $\varepsilon_I = \left\{(i,j) \in I \times I\, \middle|\, \forall \lambda \in
    \Lambda: p_{\lambda i}=0 \iff p_{\lambda j}=0 \right\}$;
\item $\mathcal{T} \subseteq \varepsilon_\Lambda$, where
  $\varepsilon_\Lambda = \left\{(\lambda,\mu) \in \Lambda \times \Lambda\,
    \middle|\, \forall i \in I: p_{\lambda i}=0 \iff p_{\mu i}=0 \right\}$;
\item For all $i,j \in I$ and $\lambda, \mu \in \Lambda$ such that
  $p_{\lambda i}, p_{\lambda j}, p_{\mu i}, p_{\mu j} \neq 0$ and either
  $(i,j) \in \mathcal{S}$ or $(\lambda,\mu) \in \mathcal{T}$, we have that
  $q_{\lambda \mu i j} \in N$, where
  $$q_{\lambda \mu i j} = p_{\lambda i} p_{\mu i}^{-1} p_{\mu j} p_{\lambda
    j}^{-1}.$$
\end{enumerate}
We shall first find all the triples which satisfy conditions (1) and (2), and
then we shall show that in this case all of them satisfy condition (3).

First, recall that an element $p_{\lambda i}$ is non-zero if and only if the
corresponding $\HH$-class is a group.  By Lemma \ref{lem:dk-hclasses} we can see
that for any pair of columns $i,j \in I$ there exists a row
$\lambda \in \Lambda$ such that $p_{\lambda i} \neq 0 = p_{\lambda j}$.  Hence
$\varepsilon_I = \Delta_I$.  Similarly, in the limited case that $k>1$, Lemma
\ref{lem:dk-hclasses} gives us that for any pair of rows
$\lambda, \mu \in \Lambda$ there exists a column $i \in I$ such that
$p_{\lambda i} \neq 0 = p_{\mu i}$.  Hence if $k>1$ then we have
$\varepsilon_\Lambda = \Delta_\Lambda$.

\subsubsection{Linked Triples for $k = 1$}
\label{sec:k1}
First let us consider the linked triples of $\pf{D_1^n}$.  Since this
$\DD$-class consists of the transformations with rank $1$, its elements have $n$
possible images,
$$\{1\}, \{2\}, \dots, \{n\}$$
and only one possible kernel,
$$\big\{\{1, \dots, n\}\big\}.$$
Hence the matrix $P$ of $\pf{D_1^n}$ has $n$ rows and $1$ column.  Every element in
$D_1^n$ has the form
$$\begin{pmatrix}
  1 & 2 & \cdots & n \\
  i & i & \cdots & i
\end{pmatrix}$$ for some $i \in \{1, \dots, n\}$, so each element is an
idempotent in its own $\HH$-class.  Hence each $\HH$-class is a group, so the
matrix $P$ has no zeroes, and $\varepsilon_\Lambda = \Lambda \times \Lambda$.
The underlying group $G$ of the Rees 0-matrix semigroup $\pf{D_1^n}$ must be
trivial, since each $\HH$-class contains just one element.

Taking all this information together, we can classify all the triples $(N,
\mathcal{S}, \mathcal{T})$ which satisfy conditions (1) and (2) as follows:
\begin{itemize}
\item $N$ must be a normal subgroup of the trivial group---hence $N = 1$;
\item $\mathcal{S}$ must be a subset of the trivial relation $\Delta_I$---hence
  $\mathcal{S} = \Delta_I$;
\item $\mathcal{T}$ may be any equivalence on $\Lambda$.
\end{itemize}
This gives us all triples of the form $(1,\Delta_I,\mathcal{T})$, where
$\mathcal{T}$ can be any partition of the $n$ rows in $\Lambda$.  The number of
these triples is the Bell number $B_n$.  Now consider condition (3): since the
underlying group of $\pf{D_1^n}$ is trivial, and our chosen normal subgroup $N$ is
also trivial, we have that any four nonzero elements from the matrix $P$ must
multiply together to give the identity $1$, which will always be in $N$.  Hence all the
triples described are \textit{linked}, and there are $B_n$ of them.

\subsubsection{Linked Triples for $k \geq 2$}
\label{sec:k2}
Now let us consider the linked triples of $\pf{D_k^n}$ for $k \geq 2$.  We already
know that $\varepsilon_I = \Delta_I$ and $\varepsilon_\Lambda = \Delta_\Lambda$,
so any triple satisfying conditions (1) and (2) must have the form
$$(N, \Delta_I, \Delta_\Lambda)$$
with freedom only in the choice of a normal subgroup $N$ of $G$.  We may write
this simply as $(N, \Delta, \Delta)$ for brevity.  This
underlying group $G$ is, as stated above, isomorphic to the symmetric group
$S_k$, so $N$ can be chosen to be any normal subgroup of $S_k$.

The only normal subgroups of $S_k$ for $k=3$ and $k \geq 5$ are the trivial group, the
alternating group $A_k$, and the symmetric group $S_k$ itself.  For $k=2$ we
have $1 = A_2 < S_2$, and for $k=4$ alone we must add a fourth normal subgroup,
$K_4 = \langle (1~2)(3~4), (1~3)(2~4) \rangle$.

To see that all these triples also fulfil condition (3) we use the triviality of
the relations $\mathcal{S} = \Delta_I$ and $\mathcal{T} = \Delta_\Lambda$.
Observe that $(i,j) \in \mathcal{S}$ only if $i = j$, and $(\lambda,\mu) \in
\mathcal{T}$ only if $\lambda = \mu$.  In the former case, we have
$$q_{\lambda \mu i j} = p_{\lambda i} (p_{\mu i}^{-1} p_{\mu i}) p_{\lambda
  i}^{-1} = p_{\lambda i} p_{\lambda i}^{-1} = 1 \in N,$$
and in the latter case,
$$q_{\lambda \mu i j} = (p_{\lambda i} p_{\lambda i}^{-1}) (p_{\lambda j}
p_{\lambda j}^{-1}) = 1 \cdot 1 = 1 \in N.$$ Hence condition (3) is fulfilled
and all of the triples described are \textit{linked}.

\subsubsection{Numbers of Congruence Classes}
\label{sec:nrclasses}
The universal congruence $\pf{D_k^n} \times \pf{D_k^n}$ has, by definition, one
congruence class.  Any other congruence on a principal factor has a linked
triple $(N,\mathcal{S},\mathcal{T})$, and we can use this triple to calculate
the number of congruence classes.  Each non-zero class corresponds to a triple
$(Nx,[i]_\mathcal{S},[\lambda]_\mathcal{T})$ consisting of a coset of $N$, a
class of $\mathcal{S}$ and a class of $\mathcal{T}$, as described in
\cite[Theorem 3.2]{mtorpey_pre_msc}.  Hence the total number of classes is equal
to the product of the index $|G:N|$, the number of classes of $\sS$, and the
number of classes of $\tT$, plus $1$ for the universal congruence.

\subsubsection{Summary of Results}
\label{sec:summary}
We can now describe all the congruences of the principal factors $\pf{D_k^n}$ of the
full transformation monoid $\mathcal{T}_n$.  If $(N,\mathcal{S},\mathcal{T})$ is a linked
triple on $\pf{D_k^n}$, then let $[N,\mathcal{S},\mathcal{T}]$ be the non-universal
congruence associated with that triple.
For brevity, let $[N] = [N, \Delta_I, \Delta_\Lambda]$ and
let $h_n = \binom{n}{k} \cdot S(n,k)$, the number of
$\HH$-classes in $D_k^n$.

\begin{theorem}
  \label{thm:dkstar-congs}
  The congruences of $\pf{D_k^n}$ are shown in Table \ref{tab:dkstar-congs}.
  \begin{table}[h]
    \centering
    \renewcommand{\arraystretch}{1.3}
    \begin{tabular}{| r | r | c | r |}
      \hline
      \multicolumn{1}{|c|}{$k$} & \multicolumn{1}{|c|}{\textbf{Congruences of $\pf{D_k^n}$}} & \textbf{Number} & \multicolumn{1}{|c|}{\textbf{Number of classes}} \\
      \hline
      $1$ & $[1, \Delta_I, \mathcal{T}] (\forall \mathcal{T})$ & $B_n$
          & from $1$ to $n$ \\
      $2$ & $[1], [S_2], \nabla$ & $3$ & $2h_2+1, h_2+1, 1$ \\
      $3$ & $[1], [A_3], [S_3], \nabla$ & $4$ & $6h_3+1, 2h_3+1, h_3+1, 1$ \\
      $4$ & $[1], [K_4], [A_4], [S_4], \nabla$ & $5$ & $24h_4+1, 6h_4+1, 2h_4+1, h_4+1, 1$ \\
      $\geq 5$ & $[1], [A_k], [S_k], \nabla$ & $4$ & $k!h_k+1, 2h_k+1, h_k+1, 1$ \\
      \hline
    \end{tabular}
    \caption{Summary of the congruences of the principal factors of $\T_n$}
    \label{tab:dkstar-congs}
  \end{table}
\end{theorem}

We can now summarise the numbers of congruence classes for some small values of
$n$.  Table \ref{tab:dkstar-nrclasses} gives the number of classes of each
congruence on each principal factor $\pf{D_k^n}$ of $\T_n$, for $n$ up to $7$.
Note that for $k=1$ only the set of distinct values has been given, since there
are $B_n+1$ different congruences which must be considered.

\begin{table}[h]
  \centering
  \renewcommand{\arraystretch}{1.3}
  \begin{tabular}{|r|r|r|r|r|r|r|r|r|}
    \hline
    & $n=1$ & $n=2$ & $n=3$ & $n=4$ & $n=5$ \\ \hline
    $k=1$ & $1$ & $1$ to $2$ & $1$ to $3$ & $1$ to $4$ & $1$ to $5$ \\
    $k=2$ & -- & 3, 2, 1 & 19, 10, 1 & 85, 43, 1 & 301, 151, 1 \\
    $k=3$ & -- & -- & 7, 3, 2, 1 & 145, 49, 25, 1 & 1501, 501, 251, 1 \\
    $k=4$ & -- & -- & -- & 25, 7, 3, 2, 1 & 1201, 301, 101, 51, 1 \\
    $k=5$ & -- & -- & -- & -- & 121, 3, 2, 1 \\
    \hline
  \end{tabular}

  \phantom{BLANK}
  
  \begin{tabular}{|r|r|r|}
    \hline
    & $n=6$ & $n=7$ \\ \hline
    $k=1$ & $1$ to $6$ & $1$ to $7$ \\
    $k=2$ & 931, 466, 1 & 2647, 1324, 1 \\
    $k=3$ & 10801, 3601, 1801, 1 & 63211, 21071, 10536, 1 \\
    $k=4$ & 23401, 5851, 1951, 976, 1 & 294001, 73501, 24501, 12251, 1 \\
    $k=5$ & 10801, 181, 91, 1 & 352801, 5881, 2941, 1 \\
    $k=6$ & 721, 3, 2, 1 & 105841, 295, 148, 1 \\
    $k=7$ & -- & 5041, 3, 2, 1 \\
    \hline
  \end{tabular}
  \caption[Congruence classes on principal factors of $\T_n$]{Number of classes
    of the congruences on the principal factors of $\T_n$, for $n$ up to $7$}
  \label{tab:dkstar-nrclasses}
\end{table}

\begin{table}[h]
  \centering
\end{table}

\subsection{Other monoids}



\section{The number of congruences of a semigroup}
\label{sec:nrcongs}

Now that it is possible to compute the congruences of a semigroup, we may be
interested in the number of congruences a given semigroup possesses.  At the
very least, a semigroup $S$ must have congruences $\Delta_S$ and $\nabla_S$,
which are equal if and only if $|S| = 1$; so any semigroup has at least one
congruence.  For an upper bound, consider that a congruence is an equivalence;
the number of equivalences on a set is given by the Bell numbers
\citeoeis{A000110}, so $S$ cannot have more congruences than the Bell number
$B_{|S|}$.  All semigroups have a number of congruences between these two
bounds, but the precise number depends on the structure of the semigroup.

In this section, we consider how many congruences there are on various
semigroups, showing some computational results on small semigroups, as well as
proving some more general results.

\subsection{Congruence-full semigroups}
% TODO: this section needs a full rethink of infinite semigroups

We start by giving the definition of a \textit{congruence-full} semigroup, by
analogy with a \textit{congruence-free} semigroup \cite[\S3.7]{howie}.

\begin{definition}
  A semigroup $S$ is \textbf{congruence-full} if every equivalence relation on
  $S$ is a congruence.
\end{definition}

Since the number of equivalences on a set is given by the sequence of Bell
numbers $(B_n)_{n \in \mathbb{N}}$, we can say that a semigroup is
congruence-full if and only if it has precisely $B_n$ congruences, where $n$ is
the size of the semigroup.
% TODO: semigroup might be infinite!  No such thing as n.

Finite congruence-free semigroups are classified in \cite[3.7]{howie}.
In this section we explore finite congruence-full semigroups, culminating in a
complete classification in Theorem \ref{thm:congruence-full}.  First we need to
build up some knowledge about the Green's relations of congruence-full
semigroups.

\begin{lemma}
  \label{lem:m-is-h-trivial}
  A congruence-full semigroup of size greater than $2$ has $\HH$-trivial
  minimal ideal.
  % TODO: infinite?  Does it have to have a minimal ideal?
  \begin{proof}
    Let $S$ be a congruence-full semigroup with more than $2$ elements, and let
    $M$ be its minimal ideal.  Since $M$ is simple, every $\HH$-class of $M$ is
    a group.  We will proceed by considering possible sizes of $M$'s
    $\HH$-classes, and showing that any size greater than $1$ violates the
    assumption that $S$ is congruence-full.

    Firstly, let $H$ be an $\HH$-class in $M$ with at least $3$ elements.  Let
    $1_H$ be the group identity of $H$, and let $g,h \in H\setminus\{1_H\}$
    with $g \neq h$.  Now let $\sim$ be $(1_H, g)^e$.  Since $g$ is not the
    identity, we know that $gh \neq h$.  Hence we have $1_H \sim g$ but
    $1_H h \nsim gh$, so $\sim$ is not a congruence.  Hence $S$ is not
    congruence-full, a contradiction.

    Instead, let $H$ be an $\HH$-class in $M$ with precisely $2$ elements.
    Since $|S| \geq 3$ we know that $S \setminus H$ is non-empty.  If there
    exists some $x \in S \setminus M$, then let $h \in H \setminus \{1_H x\}$,
    and let $\sim$ be $(x,h)^e$; since $h \neq 1_H x$ we have $x \sim h$ but
    $1_H x \nsim 1_H h$, so $\sim$ is not a congruence.  If on the other hand
    $S \setminus M$ is empty, then $M$ must contain an $\HH$-class other than
    $H$.  Choose some $x \in M \setminus H$ such that $x \LL 1_H$ (if this is
    not possible, we can choose $x$ such that $x \RR 1_H$, and a similar
    argument holds).  Let $h \in H \setminus \{1_H\}$, and let $\sim$ be
    $(x,1_H)^e$.  We have $xh \RR x \nRR h$, so $xh \nRR h$ and in particular
    $xh \neq h$.  Hence $x \sim 1_H$ but $xh \nsim 1_H h$, so $\sim$ is
    not a congruence.  Either of these cases violates the assumption that $S$
    is congruence-full, a contradiction.
  \end{proof}
\end{lemma}

\begin{lemma}
  \label{lem:m-is-l-or-r-trivial}
  A congruence-full semigroup of size greater than $2$ has a minimal ideal which
  is either $\LL$-trivial or $\RR$-trivial.
  \begin{proof}
    Let $S$ be a congruence-full semigroup with more than $2$ elements, with a
    minimal ideal $M$ which is neither $\LL$-trivial nor $\RR$-trivial.

    We know by Lemma \ref{lem:m-is-h-trivial} that $M$ is $\HH$-trivial.
    Since $M$ is simple and $\HH$-trivial, it is a rectangular band.  Let
    $x_{11}, x_{12}, x_{22} \in M$ be pairwise distinct elements with
    $x_{11} \RR x_{12} \LL x_{22}$, and let $\sim$ be the relation
    $(x_{11},x_{22})^e$.  Since $M$ is a rectangular band, we have
    $x_{11}x_{22} = x_{12}$ and $x_{11}x_{11} = x_{11}$.  Hence
    $x_{11} \sim x_{22}$ but $x_{11}x_{11} \nsim x_{11}x_{22}$, and so $\sim$ is
    not a congruence.  This means that $S$ is not congruence-full, a
    contradiction.
  \end{proof}
\end{lemma}

\begin{lemma}
  \label{lem:simple-or-zero-semigroup}
  A finite congruence-full semigroup of size greater than $2$ is either simple
  or a zero semigroup.
  \begin{proof}
    Let $S$ be a congruence-full semigroup with more than $2$ elements, with
    minimal ideal $M$.  Let us assume $S$ is not simple; this means that
    $S \setminus M$ is non-empty.  By Lemma \ref{lem:m-is-l-or-r-trivial}, $M$
    is either $\LL$-trivial or $\RR$-trivial; without loss of generality let us
    assume that $M$ is $\LL$-trivial (a similar argument applies for
    $\RR$-triviality).  We will start by proving that $S$ contains a zero, and
    then we will go on to prove that $S$ is a zero semigroup.
    Firstly, aiming for a contradiction, let us assume that $|M| > 1$.

    If $S \setminus M$ contains an idempotent, call it $x$.  Choose $m,n \in M$
    with $m \neq n$.  Now, either $mx = m$ or $mx \neq m$.  If $mx = m$, then
    let $\sim$ be $(n,x)^e$: since by $\LL$-triviality $mn = n$, and since
    $mx = m$, we have $n \sim x$ but $mn \nsim mx$, so $\sim$ is not a
    congruence, a contradiction.  If on the other hand $mx \neq m$, then let
    $\sim$ be $(m,x)^e$: since $x \neq mx \neq m$ and $xx=x$, we have $m \sim x$
    but $mx \nsim xx$, so $\sim$ is not a congruence, a contradiction.

    If instead, $S \setminus M$ does not contain an idempotent, then there must
    exist some $x \in S \setminus M$ such that $x^2 \in M$.
    \footnote{Does this fact need proof?  Does it hold for infinite semigroups?
    If so, I think we can remove the word ``finite'' everywhere and the final
    theorem is much stronger.}
    Let $m \in M \setminus \{x^2\}$ (this is possible since $|M| > 1$) and let
    $\sim$ be $(m,x)^e$.  Since by $\LL$-triviality $xm = m$, we have $m \sim x$
    but $xm \nsim xx$, so $\sim$ is not a congruence, a contradiction.

    We have now shown that $|M| > 1$ violates the condition that $S$ is
    congruence-full.  Hence the minimal ideal $M$ must contain precisely one
    element, $0$: we have $0x = x0 = 0$ for any $x \in S$, so $0$ is a zero for
    $S$. Next we will show that $S$ is a zero semigroup, i.e.~that $xy = 0$ for
    all $x,y \in S$.  Clearly if $x$ or $y$ is $0$ then $xy = 0$.

    Let $x,y \in S \setminus \{0\}$ with $x \neq y$.  The product $xy$ cannot be
    equal to both $x$ and $y$, so without loss of generality let us assume that
    $xy \neq x$.  Assume, aiming for a contradiction, that $xy \neq 0$.  Let
    $\sim$ be the relation $(x,0)^e$; since $0y = 0$ and $xy \neq x$ we have
    $x \sim 0$ but $xy \nsim 0y$, so $\sim$ is not a congruence, a
    contradiction.  Hence for distinct $x,y \in S$ we have $xy = 0$.

    It only remains to consider whether $x^2=0$ for every $x \in S$.  Let
    $x \in S \setminus \{0\}$ and assume, aiming for a contradiction, that
    $x^2 \neq 0$.  Let $y \in S \setminus \{0,x\}$ (possible since $|S| > 2$)
    and let $\sim$ be $(x,y)^e$; since $xy=0$ but $x^2 \neq 0$, we have
    $x \sim y$ but $xx \nsim xy$, so $\sim$ is not a congruence, a
    contradiction.  Hence $xy = 0$ for all $x,y \in S$, so $S$ is a zero
    semigroup.
  \end{proof}
\end{lemma}

We can now state the main theorem of this section, a classification of all the
finite congruence-full semigroups.

\begin{theorem}
  \label{thm:congruence-full}
  A finite semigroup is congruence-full if and only if it is a zero semigroup, a
  left zero semigroup, a right zero semigroup, or has size less than or equal to
  $2$.
  \begin{proof}
    Let $S$ be a finite congruence-full semigroup of size greater than $2$.  If
    $S$ is not simple, then by Lemma \ref{lem:simple-or-zero-semigroup} it is a
    zero semigroup.  If $S$ is simple, it is equal to its minimal ideal.
    Therefore, by Lemma \ref{lem:m-is-l-or-r-trivial}, $S$ is either
    $\LL$-trivial or $\RR$-trivial.  If it is $\LL$-trivial then $xy=y$ for all
    $x,y \in S$, so it is a right zero semigroup.  If it is $\RR$-trivial then
    $xy=x$ for all $x,y \in S$, so it is a left zero semigroup.

    To prove the converse, we consider zero, left zero, and right zero
    semigroups in turn.  First, let $S$ be a zero semigroup and let $\sim$ be an
    equivalence relation on $S$.  Let $x,y,s,t \in S$ such that $x \sim y$ and
    $s \sim t$.  We have $xs = 0 = yt$, so $xs \sim yt$ and therefore $\sim$ is
    a congruence.  Hence $S$ is congruence-full.

    Alternatively, let $S$ be a left zero semigroup and let $\sim$ be an
    equivalence relation on $S$.  Let $x,y,a \in S$ such that $x \sim y$.  We
    have $ax = a = ay$ and $xa = x \sim y = ya$, so $ax \sim ay$ and
    $xa \sim ya$.  Hence $\sim$ is a congruence, so $S$ is congruence-full.
    A similar argument proves the statement for right zero semigroups.

    % Mention size 2
  \end{proof}
\end{theorem}



\subsection{Semigroups with fewer congruences}

If a semigroup of size $n$ is not congruence-full, it has fewer than $B_n$
congruences.  For some low values of $n$ a semigroup may have $B_n - 1$
congruences, but as $n$ grows the number of congruences seems to be lower.  In
this section we propose a value for the ``second highest'' number of congruences
on a semigroup of size $n$.

\begin{conjecture}
  \label{conj:not-cong-full}
  A semigroup of size $n > 3$ which is not congruence-full has at most
  $2B_{n-1}$ congruences.
\end{conjecture}

This conjecture, which does not yet have a proof, is supported by experimental
investigation.  An exhaustive analysis of all semigroups up to isomorphism and
anti-isomorphism shows that the conjecture holds for $n \leq 7$, and also
reveals a pattern in the semigroups which attain the limit.  This pattern is
stated in the next conjecture.

\begin{conjecture}
  \label{conj:cong-nearfull-7}
  Let $n > 3$.  There are precisely 7 semigroups (up to isomorphism and
  anti-isomorphism) of size $n$ which have $2B_{n-1}$ congruences.
\end{conjecture}

The 7 semigroups are described in the following table, and a diagram is given
for $n = 4$.  In the descriptions, when $\Z_{n-1}$ is a subsemigroup of $S$, the
zero of $\Z_{n-1}$ is called $z$.

\begin{longtable}{| c | >{\centering}m{0.5\linewidth} | m{0.3\linewidth} |}
  \hline
  No. & Diagram of $S$ & Description of $S$
  \\ \hline
  1 & \includesvg{pics/ch-other/lz-plus-id}
  & Left-zero semigroup $\LZ_{n-1}$ with an idempotent $c$ appended.
  There is a distinguished $p \in M$ such that $cx=p$ and $xc=x$ for
  all $x \in M$.
  \\ \hline
  2 & \includesvg{pics/ch-other/lz-plus-nonid}
  & Left-zero semigroup $\LZ_{n-1}$ with a non-idempotent element $c$
  appended.
  Multiplication defined by $cx=c^2$ and $xc=x$ for all $x \in M$.
  \\ \hline
  3 & \includesvg{pics/ch-other/z-plus-zero}
  & Zero semigroup $\Z_{n-1}$ with a zero appended.
  \\ \hline
  4 & \includesvg[scale=0.8]{pics/ch-other/z-plus-id} % TODO: consistent scale
  & Zero semigroup $\Z_{n-1}$ with an idempotent $c$ appended above the minimal
  ideal.
  Multiplication defined by $cx=xc=z$ for all $x \in \Z_{n-1}$.
  \\ \hline
  5 & \includesvg{pics/ch-other/z-plus-m-id}
  & Zero semigroup $\Z_{n-1}$ with an idempotent $c$ appended in the minimal
  ideal.
  Multiplication defined by $cx=c$ and $xc=z$ for all $x \in \Z_{n-1}$.
  \\ \hline
  6 & \includesvg{pics/ch-other/c2-plus-nonids}
  & Zero semigroup $\Z_{n-1}$ with an element $c$ appended in the same
  $\HH$-class as $z$.
  Multiplication defined by $c^2=z$ and $xc=cx=c$ for all $x \in \Z_{n-1}$.
  \\ \hline
  7 & \includesvg{pics/ch-other/c2-plus-nonids}
  & Cyclic group $C_2 = \{\id, g\}$ with $n-2$ elements appended such that
  $xy=\id$, $x \id=\id x=g$ (for all $x,y \in S \setminus C_2$).
  \\ \hline
\end{longtable}

Of the 7 semigroups in the table above, semigroups 1 to 6 contain a copy of
either $\Z_{n-1}$ or $\LZ_{n-1}$ as a subsemigroup.  The one element outside
this subsemigroup, which we will call $c$ (the \textit{child element}) is key to
understanding why these semigroups have $2B_{n-1}$ congruences.  In each
semigroup, there is another element $p$ (the \textit{parent element}) such that
an equivalence $\sim$ is a congruence if and only if $c \sim p$ or $[c]_\sim$ is
a singleton.  In other words, the child has to be alone or with its parent.
Now, since $S \setminus \{c\}$ is congruence-full, we can take any congruence
(any equivalence) $\sim$ on $S \setminus \{c\}$ and extend it to a congruence on
$S$ in two different ways: by including $c$ as a singleton, or by including $c$
in the same congruence class as $p$.  Since there are $B_{n-1}$ choices for
$\sim$, this gives us precisely $2B_{n-1}$ congruences on $S$.

Semigroup 7 is unique in that it does not contain $\Z_{n-1}$ or $\LZ_{n-1}$ as a
subsemigroup.  However, it still fulfils the \textit{child/parent} condition
above, where $c = \id$ and $p = g$.

\subsection{Other findings}
We applied the methods from Chapter \ref{chap:lattice} to a bunch of semigroups,
including the partition monoids and small semigroups described elsewhere in this
thesis.

Looks like most congruences are principal?

Show some pictures of lattices on famous semigroups.
