\chapter{Principal factors and counting congruences}
\label{chap:other}

In Chapter \ref{chap:motzkin} we classified the congruences of the Motzkin
monoid and several related diagram monoids.  This classification was achieved by
first calculating the congruence lattices for small values of $n$ using the
computational techniques described in Chapters \ref{chap:pairs} and
\ref{chap:lattice}, and then building up theory in order to prove a
classification for general $n$.  In this chapter we present some more results
about congruences that were obtained in a similar way, by first looking for
patterns in computational results, and then extending the results and attempting
to prove them for larger semigroups.  The \libsemigroups{} library and the
\Semigroups{} and \smallsemi{} packages for \GAP{} were used to carry out the
initial computations \cite{libsemigroups, semigroups, smallsemi, gap}.

\section{Congruences of principal factors}
\label{sec:princfact}

In this section, we will consider an interesting decomposition of a semigroup
related to its $\JJ$-classes: a semigroup's \textit{principal factors}.  After
defining this construction, we will consider the principal factors of the full
transformation monoid $\T_n$, and classify their congruences.  After this, we
will look at the principal factors of some other, somewhat similar monoids, and
classify their congruences using similar principles.

\subsection{Principal factors}
\label{sec:princfact-def}

Recall that a semigroup's $\JJ$-classes have a natural partial order $\leq$,
defined as follows: if $J_1$ and $J_2$ are $\JJ$-classes of $S$, then
$J_1 \leq J_2$ if and only if $S^1 J_1 S^1 \subseteq S^1 J_2 S^1$.  For finite
semigroups we have $\jJ=\dD$, and this partial order is shown on eggbox diagrams
by the placement of $\DD$-classes above and below each other, as in Figure
\ref{fig:eggbox-diagram}.  Given a $\JJ$-class $J$ of a semigroup $S$, we can
define the ideal $I_J$ generated by $J$, which is given by $I_J = S^1 J S^1$.
If $J$ is not minimal, we can also define the ideal of all $\JJ$-classes below
$J$, which is given by $I_J \setminus J$.  Since $I_J \setminus J$ is an ideal
of $I_J$, we can use it to take a Rees congruence, and a Rees quotient (see
Definition \ref{def:rees-congruence}).  This allows us to make the following
definition.
\nomenclature[IJ]{$I_J$}{Ideal generated by a $\JJ$-class}

\begin{definition}
  \label{def:princfact}
  \index{principal factor}
  \nomenclature[-]{$\pf{\phantom{D}}$}{Principal factor}
  Let $S$ be a semigroup, and let $J$ be a $\JJ$-class of $S$.  The
  \textbf{principal factor} of $J$ is denoted by $\pf{J}$, and defined as
  follows:
  \begin{itemize}
  \item $\pf{J} = J$ if $J$ is the minimal ideal;
  \item $\pf{J} = I_J / (I_J \setminus J)$ otherwise.
  \end{itemize}
\end{definition}

If $J$ is not the minimal ideal, then the principal factor $\pf{J}$ is
isomorphic to the set $J \cup \{0\}$, with multiplication $\circ$ defined by
$$a \circ b = \left\{
  \begin{array}{l l}
    ab & \text{if~} a,b \in J; \\
    0 & \text{otherwise}.
  \end{array}\right.$$
In the case that $J$ is the minimal ideal of $S$, we do not need to append a
zero.

Since $\pf{J}$ is composed of a single $\JJ$-class, possibly with a zero
appended, it is a simple or 0-simple semigroup.  Hence, if $S$ is finite, we may
identify $\pf{J}$ with a Rees matrix semigroup $\mathcal{M}[G;I,\Lambda;P]$ or
Rees 0-matrix semigroup $\mathcal{M}^0[G;I,\Lambda;P]$, by the Rees Theorem
(Theorem \ref{thm:rees}).  This will help us to classify its congruences later,
using the concept of linked triples (see Definition \ref{def:linked-triple}).

\subsection{Full transformation monoid $\T_n$}
\label{sec:princfact-tn}

Now we will consider the principal factors of an important monoid, the full
transformation monoid $\T_n$.  Recall that $\T_n$ is the monoid consisting of
all transformations on the set $\{1, \dots, n\}$, for some $n \in \mathbb{N}$
(Definition \ref{def:tn}).  In order to describe the principal factors of
$\T_n$, we must first consider its Green's relations, as follows.

\begin{proposition}
  \label{prop:tn-greens}
  Let $n \in \mathbb{N}$, and let $\T_n$ be the full transformation monoid of
  degree $n$.  For two mappings $\alpha, \beta \in \T_n$, the following hold:
  \begin{itemize}
  \item $\alpha \LL \beta$ if and only if $\im \alpha = \im \beta$,
  \item $\alpha \RR \beta$ if and only if $\ker \alpha = \ker \beta$,
  \item $\alpha \DD \beta$ if and only if $\rank \alpha = \rank \beta$.
  \end{itemize}
  % TODO? prove this myself
\end{proposition}

The last part of the above proposition allows us to name the semigroup's
$\DD$-classes $D_1^n, D_2^n, \dots, D_n^n$, where each $D_k^n$ is the
$\DD$-class of $\T_n$ consisting of transformations with rank $k$.  Then the
usual partial ordering of $\JJ$-classes (which in a finite semigroup are the
same as $\DD$-classes) gives $D_1^n < D_2^n < \dots < D_n^n$.

Inside a given $\DD$-class $D_k^n$, elements are divided into $\LL$-classes
according to their image set; since all elements have rank $k$, their images
must have size $k$, and so there are $\binom{n}{k}$ $\LL$-classes in total.
Similarly, the elements of $D_k^n$ are divided into $\RR$-classes according to
their kernel; the possible kernels are all $k$-partitions of an $n$-set, so the
total number of $\RR$-classes is given by the Stirling number of the second
kind, $S(n,k)$ \citeoeis{A008277}.

Each $\HH$-class in $D_k^n$ is the intersection of an $\LL$-class and an
$\RR$-class, so each one corresponds to an image-kernel pair (hence we will talk
about the \textit{image and kernel of an $\HH$-class}).  For a given kernel with
$k$ classes and a given image with $k$ elements, there are $k!$ different ways
to assign image elements to kernel classes, simply the permutations of the set
$\{1, \dots, k\}$.  Hence there are $k!$ elements in each $\HH$-class.

\subsubsection{Group $\HH$-classes of $\T_n$}
To understand the principal factor corresponding to a $\DD$-class $D_k^n$, we need
to understand which of its $\HH$-classes are groups and which are not.  To
determine which $\HH$-classes are groups, we recall that in any semigroup an
$\HH$-class $H$ is a group if and only if it contains an idempotent (an element
$\alpha \in H$ such that $\alpha \alpha = \alpha$).  A transformation
$\alpha \in \T_n$ is an idempotent if and only if each point in its image is
mapped by $\alpha$ to itself, i.e.
$$i \alpha = i \quad (\forall i \in \im \alpha).$$
Given an image and a kernel, we can choose a transformation with this condition
if and only if no pair of points in the image are in the same
kernel-class -- that is, each image point is in a different kernel-class.  Hence
an $\HH$-class of $D_k^n$ is a group if and only if its image contains one point
from each class of its kernel (i.e.~its image is a \textit{cross-section} of its
kernel).  \index{cross-section}

\begin{lemma}
  \label{lem:dk-hclasses}
  Let $k,n \in \mathbb{N}$ with $k \leq n$, and let $D_k^n$ be the $\DD$-class
  of $\T_n$ consisting of the elements of rank $k$.  The following hold:
  \begin{enumerate}[\rm(1)]
  \item For any two distinct $\RR$-classes $R_1$ and $R_2$ of $D_k^n$ there is an
    $\LL$-class $L$ such that $L \cap R_1$ is a group $\HH$-class, but
    $L \cap R_2$ is not.
  \item If $k > 1$, then for any two distinct $\LL$-classes $L_1$ and $L_2$ of
    $D_k^n$ there is an $\RR$-class $R$ such that $L_1 \cap R$ is a group
    $\HH$-class, but $L_2 \cap R$ is not.
  \end{enumerate}
  \begin{proof}
    For (1), let $R_1$ and $R_2$ be distinct $\RR$-classes of $D_k^n$.  These two
    classes correspond to distinct kernels $P_1$ and $P_2$, each partitioning
    $\{1, \dots, n\}$ into $k$ classes.  If $k=n$ then there is only one
    possible partition, $\big\{\{1\}, \dots, \{n\}\big\}$, and so $R_1$ and
    $R_2$ cannot be distinct.  If $k<n$ then there must be a pair of elements
    $i,j \in \{1,\dots, n\}$ which are in different classes of $P_1$ but the
    same class of $P_2$.  Let $X$ be a $k$-set containing one element from each
    class of $P_1$, including $i$ and $j$ -- clearly it is a cross-section of
    $P_1$.  But now $X$ contains two elements from one class of $P_2$, so it is
    not a cross-section of $P_2$.  Hence, if $L$ is the $\LL$-class
    corresponding to image $X$, $L \cap R_1$ is a group $\HH$-class but
    $L \cap R_2$ is not a group $\HH$-class.

    For (2), let $L_1$ and $L_2$ be distinct $\LL$-classes of $D_k^n$, with
    $1 < k \leq n$.  These two classes correspond to distinct images of size $k$
    in $\{1 \dots n\}$; let us call these images $I_1$ and $I_2$ respectively.
    Without loss of generality, let $I_1 = \{1, 2, \dots, k\}$.  Since
    $I_1 \neq I_2$, there must be an element $i \in \{1 \dots k\}$ not in $I_2$.
    Now consider the $k$-partition $P$ which puts each element from
    $\{1 \dots k\}$ in a class on its own, apart from one element
    $j \in \{1 \dots k\}$ not equal to $i$, which is in a class with all the
    elements $\{k+1 \dots n\}$ (choosing $j \neq i$ requires $k > 1$).  Now
    $I_1$ is a cross-section of $P$, having precisely one element from each
    class; but $I_2$ does not have an element from the class $\{i\}$, and so it
    is not a cross-section of $P$.  Let $R$ be the $\RR$-class with kernel $P$,
    and we have that $L_1 \cap R$ is a group $\HH$-class but $L_2 \cap R$ is
    not.
  \end{proof}
\end{lemma}

\subsubsection{Principal factors of $\T_n$}
As mentioned in Section \ref{sec:princfact-def}, any principal factor is either
simple or 0-simple, and so it can be identified with a Rees matrix semigroup or
Rees 0-matrix semigroup.  Hence, for some $k > 1$, let
$\pf{D_k^n} = \mathcal{M}^0[G;I,\Lambda;P]$.  The rows and columns of the matrix
$P$ correspond respectively to the $\LL$-classes and $\RR$-classes of $D_k^n$,
and $G$ is the group isomorphic to each of the group $\HH$-classes of $D_k^n$.
Since the elements of an $\HH$-class here correspond to all the permutations of
its image (all the different ways to assign the $k$ image points to the $k$
classes of the kernel) this group is isomorphic to the symmetric group $\Sym_k$.

To consider the congruences of $\pf{D_k^n}$, we first recognise the universal
congruence $\nabla_{\pf{D_k^n}}$.  All the other congruences are in bijective
correspondence with the linked triples of $\pf{D_k^n}$.  Recall the definition
of a linked triples $(N,\mathcal{S},\mathcal{T})$, from Definition
\ref{def:linked-triple} -- that is, a normal subgroup $N \trianglelefteq G$, an
equivalence relation $\mathcal{S}$ on $I$ and an equivalence relation
$\mathcal{T}$ on $\Lambda$, such that the following are satisfied:
\begin{enumerate}[\rm(1)]
\item $\mathcal{S} \subseteq \varepsilon_I$, where
  $\varepsilon_I = \left\{(i,j) \in I \times I\, \middle|\, \forall \lambda \in
    \Lambda: p_{\lambda i}=0 \iff p_{\lambda j}=0 \right\}$;
\item $\mathcal{T} \subseteq \varepsilon_\Lambda$, where
  $\varepsilon_\Lambda = \left\{(\lambda,\mu) \in \Lambda \times \Lambda\,
    \middle|\, \forall i \in I: p_{\lambda i}=0 \iff p_{\mu i}=0 \right\}$;
\item For all $i,j \in I$ and $\lambda, \mu \in \Lambda$ such that
  $p_{\lambda i}, p_{\lambda j}, p_{\mu i}, p_{\mu j} \neq 0$ and either
  $(i,j) \in \mathcal{S}$ or $(\lambda,\mu) \in \mathcal{T}$, we have that
  $q_{\lambda \mu i j} \in N$, where
  $$q_{\lambda \mu i j} = p_{\lambda i} p_{\mu i}^{-1} p_{\mu j} p_{\lambda
    j}^{-1}.$$
\end{enumerate}
We shall first find all the triples which satisfy conditions (1) and (2), and
then we shall show that in this case all of them satisfy condition (3).

First, recall that an element $p_{\lambda i}$ is non-zero if and only if the
corresponding $\HH$-class is a group.  By Lemma \ref{lem:dk-hclasses} we can see
that for any pair of columns $i,j \in I$ there exists a row
$\lambda \in \Lambda$ such that $p_{\lambda i} \neq 0 = p_{\lambda j}$.  Hence
$\varepsilon_I = \Delta_I$.  Similarly, in the limited case that $k>1$, Lemma
\ref{lem:dk-hclasses} gives us that for any pair of rows
$\lambda, \mu \in \Lambda$ there exists a column $i \in I$ such that
$p_{\lambda i} \neq 0 = p_{\mu i}$.  Hence if $k>1$ then we have
$\varepsilon_\Lambda = \Delta_\Lambda$.

\subsubsection{Linked triples for rank 1}
\label{sec:k1}
First let us consider the linked triples of $\pf{D_1^n}$.  Since this
$\DD$-class consists of the transformations with rank $1$, its elements have $n$
possible images,
$$\{1\}, \{2\}, \dots, \{n\}$$
and only one possible kernel,
$$\big\{\{1, \dots, n\}\big\}.$$
Hence the matrix $P$ of $\pf{D_1^n}$ has $n$ rows and $1$ column.  Since
$\pf{D_1^n}$ is simple, this means that it is a right zero semigroup.  Later in
this chapter we will see that every equivalence on a right zero semigroup is a
congruence (see Theorem \ref{thm:congruence-full}).  For now we will classify
the congruences using linked triples.  Every element in $D_1^n$ has the form
$$\begin{pmatrix}
  1 & 2 & \cdots & n \\
  i & i & \cdots & i
\end{pmatrix}$$ for some $i \in \{1, \dots, n\}$, so each element is an
idempotent in its own $\HH$-class.  Hence each $\HH$-class is a group, so the
matrix $P$ has no zeroes, and $\varepsilon_\Lambda = \Lambda \times \Lambda$.
The underlying group $G$ of the Rees 0-matrix semigroup $\pf{D_1^n}$ must be
trivial, since each $\HH$-class contains just one element.

Taking all this information together, we can classify all the triples $(N,
\mathcal{S}, \mathcal{T})$ which satisfy conditions (1) and (2) as follows:
\begin{itemize}
\item $N$ must be a normal subgroup of the trivial group -- hence $N = 1$;
\item $\mathcal{S}$ must be a subset of the trivial relation $\Delta_I$ -- hence
  $\mathcal{S} = \Delta_I$;
\item $\mathcal{T}$ may be any equivalence on $\Lambda$.
\end{itemize}
This gives us all triples of the form $(1,\Delta_I,\mathcal{T})$, where
$\mathcal{T}$ can be any partition of the $n$ rows in $\Lambda$.  The number of
these triples is the Bell number $B_n$.  Now consider condition (3): since the
underlying group of $\pf{D_1^n}$ is trivial, and our chosen normal subgroup $N$ is
also trivial, we have that any four nonzero elements from the matrix $P$ must
multiply together to give the identity $1$, which will always be in $N$.  Hence all the
triples described are \textit{linked}, and there are $B_n$ of them.

\subsubsection{Linked triples for rank 2 and higher}
\label{sec:k2}
Now let us consider the linked triples of $\pf{D_k^n}$ for $k \geq 2$.  By Lemma
\ref{lem:dk-hclasses} we
know that $\varepsilon_I = \Delta_I$ and $\varepsilon_\Lambda = \Delta_\Lambda$,
so any triple satisfying conditions (1) and (2) must have the form
$$(N, \Delta_I, \Delta_\Lambda)$$
with freedom only in the choice of a normal subgroup $N$ of $G$.  We may write
this simply as $(N, \Delta, \Delta)$ for brevity.  This
underlying group $G$ is, as stated above, isomorphic to the symmetric group
$\Sym_k$, so $N$ can be chosen to be any normal subgroup of $\Sym_k$.

The only normal subgroups of $\Sym_k$ for $k=3$ and $k \geq 5$ are the trivial group, the
alternating group $\Alt_k$, and the symmetric group $\Sym_k$ itself.  For $k=2$ we
have $1 = \Alt_2 < \Sym_2$, and for $k=4$ alone we must add a fourth normal subgroup,
$K_4 = \langle (1~2)(3~4), (1~3)(2~4) \rangle$.

To see that all these triples also fulfil condition (3) we use the triviality of
the relations $\mathcal{S} = \Delta_I$ and $\mathcal{T} = \Delta_\Lambda$.
Observe that $(i,j) \in \mathcal{S}$ only if $i = j$, and $(\lambda,\mu) \in
\mathcal{T}$ only if $\lambda = \mu$.  In the former case, we have
$$q_{\lambda \mu i j} = p_{\lambda i} (p_{\mu i}^{-1} p_{\mu i}) p_{\lambda
  i}^{-1} = p_{\lambda i} p_{\lambda i}^{-1} = 1 \in N,$$
and in the latter case,
$$q_{\lambda \mu i j} = (p_{\lambda i} p_{\lambda i}^{-1}) (p_{\lambda j}
p_{\lambda j}^{-1}) = 1 \cdot 1 = 1 \in N.$$ Hence condition (3) is fulfilled
and all of the triples described are \textit{linked}.

\subsubsection{Numbers of Congruence Classes}
\label{sec:nrclasses}
The universal congruence $\nabla_{\pf{D_k^n}}$ has, by definition, one
congruence class.  Any other congruence on a principal factor has a linked
triple $(N,\mathcal{S},\mathcal{T})$, and we can use this triple to calculate
the number of congruence classes.  Each non-zero class corresponds to a triple
$(Nx,[i]_\mathcal{S},[\lambda]_\mathcal{T})$ consisting of a coset of $N$, a
class of $\mathcal{S}$ and a class of $\mathcal{T}$, as described in
\cite[Theorem 3.2]{mtorpey_pre_msc}.  Hence the total number of classes is equal
to the product of the index $|G:N|$, the number of classes of $\sS$, and the
number of classes of $\tT$, plus $1$ for the universal congruence.  Many of our
congruences have $\sS=\Delta_I$ and $\tT=\Delta_\Lambda$; the total number of
classes for these congruences will be
$$|G:N| \cdot |I| \cdot |\Lambda| + 1
\quad=\quad \big|\Sym_k:N\big| S(n,k) \binom{n}{k} + 1.$$

\subsubsection{Summary of Results}
\label{sec:summary}
We can now describe all the congruences of the principal factors $\pf{D_k^n}$ of
the full transformation monoid $\mathcal{T}_n$.  If
$(N,\mathcal{S},\mathcal{T})$ is a linked triple on $\pf{D_k^n}$, then let
$[N,\mathcal{S},\mathcal{T}]$ be the non-universal congruence associated with
that triple.  For brevity, let $[N] = [N, \Delta_I, \Delta_\Lambda]$ and let
$h_k^n = S(n,k) \cdot \binom{n}{k}$, the number of $\HH$-classes in $D_k^n$.

\begin{theorem}
  \label{thm:dkstar-congs}
  The congruences of $\pf{D_k^n}$ are shown in Table \ref{tab:dkstar-congs}.
  \begin{table}[ht]
    \centering
    \renewcommand{\arraystretch}{1.3}
    \begin{tabular}{| r | r | c | r |}
      \hline
      \multicolumn{1}{|c|}{$k$} & \multicolumn{1}{c|}{\textbf{Congruences of $\pf{D_k^n}$}} & \textbf{Number} & \multicolumn{1}{c|}{\textbf{Number of classes}} \\
      \hline
      $1$ & $[1, \Delta_I, \mathcal{T}] (\forall \mathcal{T})$ & $B_n$
          & from $1$ to $n$ \\
      $2$ & $[1], [\Sym_2], \nabla$ & $3$ & $2h_2^n+1, h_2^n+1, 1$ \\
      $3$ & $[1], [\Alt_3], [\Sym_3], \nabla$ & $4$ & $6h_3^n+1, 2h_3^n+1, h_3^n+1, 1$ \\
      $4$ & $[1], [K_4], [\Alt_4], [\Sym_4], \nabla$ & $5$ & $24h_4^n+1, 6h_4^n+1, 2h_4^n+1, h_4^n+1, 1$ \\
      $\geq 5$ & $[1], [\Alt_k], [\Sym_k], \nabla$ & $4$ & $k!h_k^n+1, 2h_k^n+1, h_k^n+1, 1$ \\
      \hline
    \end{tabular}
    \caption{Congruences of the principal factors of $\T_n$}
    \label{tab:dkstar-congs}
  \end{table}
\end{theorem}

We can now summarise the numbers of congruence classes for some small values of
$n$.  Table \ref{tab:dkstar-nrclasses} gives the number of classes of each
congruence on each principal factor $\pf{D_k^n}$ of $\T_n$, for $n$ up to $7$.
Note that for $k=1$ only the set of distinct values has been given, since there
are $B_n+1$ different congruences which must be considered.

\begin{table}[ht]
  \centering
  \renewcommand{\arraystretch}{1.3}
  \begin{tabular}{|r|r|r|r|r|r|r|r|r|}
    \hline
    & $n=1$ & $n=2$ & $n=3$ & $n=4$ & $n=5$ \\ \hline
    $k=1$ & $1$ & $1$ to $2$ & $1$ to $3$ & $1$ to $4$ & $1$ to $5$ \\
    $k=2$ & -- & 3, 2, 1 & 19, 10, 1 & 85, 43, 1 & 301, 151, 1 \\
    $k=3$ & -- & -- & 7, 3, 2, 1 & 145, 49, 25, 1 & 1501, 501, 251, 1 \\
    $k=4$ & -- & -- & -- & 25, 7, 3, 2, 1 & 1201, 301, 101, 51, 1 \\
    $k=5$ & -- & -- & -- & -- & 121, 3, 2, 1 \\
    \hline
  \end{tabular}

  \phantom{BLANK}
  
  \begin{tabular}{|r|r|r|}
    \hline
    & $n=6$ & $n=7$ \\ \hline
    $k=1$ & $1$ to $6$ & $1$ to $7$ \\
    $k=2$ & 931, 466, 1 & 2647, 1324, 1 \\
    $k=3$ & 10801, 3601, 1801, 1 & 63211, 21071, 10536, 1 \\
    $k=4$ & 23401, 5851, 1951, 976, 1 & 294001, 73501, 24501, 12251, 1 \\
    $k=5$ & 10801, 181, 91, 1 & 352801, 5881, 2941, 1 \\
    $k=6$ & 721, 3, 2, 1 & 105841, 295, 148, 1 \\
    $k=7$ & -- & 5041, 3, 2, 1 \\
    \hline
  \end{tabular}
  \caption[Congruence classes of principal factors of $\T_n$]{Number of classes
    of the congruences on the principal factors of $\T_n$, for $n$ up to $7$}
  \label{tab:dkstar-nrclasses}
\end{table}

\subsection{Other semigroups}
\label{sec:princfact-other}

Now that we have considered the principal factors of the full transformation
monoid, we can go on to consider the principal factors of some other semigroups
related to $\T_n$, and classify their congruences.  The proofs are broadly
similar to those for $\T_n$, so we will only summarise the arguments,
highlighting the parts where they differ from those in Section
\ref{sec:princfact-tn}.  We start by extending our consideration of
transformations to partial transformations and then to partial permuations; then
we consider the three corresponding order-preserving submonoids.

\subsubsection{Partial transformation monoid $\PT_n$}
\label{sec:princfact-ptn}
Recall that $\PT_n$ is the monoid of all partial transformations on the set
$\bn = \{1, \ldots, n\}$, that is, all transformations on some subset of $\bn$.
In many respects a partial transformation behaves like a transformation: it has
an image, a rank (the size of the image), and a kernel.  However, we should also
consider a partial transformation's codomain: the set of points which it maps.
The kernel is a partition of the codomain.  Using these definitions, the Green's
relations of $\PT_n$ are described in the same way as those of $\T_n$: the
$\DD$-classes are determined by rank, the $\LL$-classes by image, the
$\RR$-classes by kernel, and the $\HH$-classes by image and kernel.  Idempotents
are also described in the same way: a partial transformation $\alpha \in \PT_n$
is an idempotent if and only if its image is a cross-section of its kernel.

The $\DD$-classes of $\PT_n$ are somewhat different from $\T_n$.  Firstly, there
exists an element $0 = \transN---$ with rank $0$, so we have an additional
$\DD$-class $D_0^n$.  For a given rank $k$, there are still $\binom{n}{k}$
possible images with size $k$, so the $\DD$-class $D_k^n$ has $\binom{n}{k}$
$\LL$-classes, like $\T_n$.  However, the possibility of points not being in the
domain mean that there are not just $S(n,k)$ possible kernels, but
$S(n+1, k+1)$; the intuition behind this is that, instead of considering all
$k$-partitions of $\{1, \ldots, n\}$, we are considering all $k+1$-partitions of
$\{1, \ldots, n+1\}$, where the class containing $n+1$ represents those points
outside the domain.

Lemma \ref{lem:dk-hclasses} holds true for $\PT_n$ -- in fact, both parts hold
even when $k = 0$ or $1$.  For $k=0$ we simply observe that $D_0^n$ is trivial,
and the two statements follow.  The proof given for (1) is sufficient for
$\PT_n$ when $k \geq 1$, so (1) is proven.  For (2), the proof given is only
sufficient for $\PT_n$ when $k \geq 2$.  For $k=1$, it is proven as follows.  We
must have $I_1 = \{i\}$ and $I_2 = \{j\}$ with $i \neq j$; simply let
$P = \big\{\{i\}\big\}$, a cross-section of $I_1$ but not $I_2$.  This is not
possible in $\T_n$ because any kernel has to contain all the elements of $\bn$
somewhere; but by missing out points from the domain, it is possible in $\PT_n$.

Since Lemma \ref{lem:dk-hclasses} holds for all $k$, we have
$\varepsilon_I = \Delta_I$ and $\varepsilon_\Lambda = \Delta_\Lambda$ in each
principal factor $\pf{D_k^n}$.  Hence every linked triple on $\pf{D_k^n}$ must
have the form $(N, \Delta, \Delta)$.  Each group $\HH$-class in $D_k^n$ is
isomorphic to $\Sym_k$, since it corresponds to all the ways of mapping the
$k$ classes of the kernel onto the $k$ points in the image.  Hence the possible
normal subgroups $N$ are again the normal subgroups of $\Sym_k$.
The congruences are summarised in Table \ref{tab:dkstar-congs-ptn}, where
$h_k^n$ is equal to $$S(n+1, k+1) \binom{n}{k},$$ the number of $\HH$-classes in
$D_k^n$.

\begin{table}[ht]
  \centering
  \renewcommand{\arraystretch}{1.3}
  \begin{tabular}{| r | r | c | r |}
    \hline
    \multicolumn{1}{|c|}{$k$} & \multicolumn{1}{c|}{\textbf{Congruences of $\pf{D_k^n}$}} & \textbf{Number} & \multicolumn{1}{c|}{\textbf{Number of classes}} \\
    \hline
    $0$ & $[1]$ & $1$ & $1$ \\
    $1$ & $[1], \nabla$ & $2$ & $h_1^n+1, 1$ \\
    $2$ & $[1], [\Sym_2], \nabla$ & $3$ & $2h_2^n+1, h_2^n+1, 1$ \\
    $3$ & $[1], [\Alt_3], [\Sym_3], \nabla$ & $4$ & $6h_3^n+1, 2h_3^n+1, h_3^n+1, 1$ \\
    $4$ & $[1], [K_4], [\Alt_4], [\Sym_4], \nabla$ & $5$ & $24h_4^n+1, 6h_4^n+1, 2h_4^n+1, h_4^n+1, 1$ \\
    $\geq 5$ & $[1], [\Alt_k], [\Sym_k], \nabla$ & $4$ & $k!h_k^n+1, 2h_k^n+1, h_k^n+1, 1$ \\
    \hline
  \end{tabular}
  \caption{Congruences of the principal factors of $\PT_n$ or
    $\I_n$}
  \label{tab:dkstar-congs-ptn}
\end{table}

\subsubsection{Symmetric inverse monoid $\I_n$}
\label{sec:princfact-in}
Recall that the symmetric inverse monoid $\I_n$ consists of all partial
permutations on the set $\bn$; that is, $\I_n$ is the submonoid of $\PT_n$
consisting of the injective maps.  The Green's relations of $\I_n$ are
determined by rank, image and kernel, as for $\PT_n$, but we can think of the
$\RR$ relation in a slightly simpler way.  Since each element of $\I_n$ is a
partial permutation, its kernel must be the diagonal relation on the domain;
hence, two elements are $\RR$-related if and only if they have the same domain.
This creates a certain symmetry between the $\LL$ and $\RR$ relations: if an
element is written in two-row notation, the set of points in the top row
determine its $\RR$-class, and the set of points in the bottom row determine its
$\LL$-class.

This symmetry makes the classification of the principal factors' congruences
quite straightforward.  The $\DD$-class $D_k^n$ of elements with rank $k$
contains $\binom{n}{k}$ $\LL$-classes and $\binom{n}{k}$ $\RR$-classes.  The
idempotents of $\I_n$ are simply the identity maps (that is, the elements
$\alpha$ such that $i\alpha = i$ for all $i \in \dom\alpha$) so an $\HH$-class
is a group if and only if its image and its domain are equal.  Hence each
$\LL$-class and each $\RR$-class contains precisely one group $\HH$-class.  This
is enough to prove the whole of Lemma \ref{lem:dk-hclasses}, for all $k$ from
$0$ to $n$.  Hence, as for $\PT_n$, all linked triples on $\pf{D_k^n}$ are of
the form $(N, \Delta, \Delta)$.

There are $k!$ elements with a given image and domain of size $k$, and if the
image and domain are equal they form a group isomorphic to $\Sym_k$, so like
$\PT_n$ we have that the choices for $N$ are all the normal subgroups of
$\Sym_k$.  The result is that the congruences of the principal factors of $\I_n$
have the same description as those of the principal factors of $\PT_n$.  They
can be seen in Table \ref{tab:dkstar-congs-ptn}, where the number of
$\HH$-classes $h_k^n$ is in this case given by $\binom{n}{k}^2$.

\subsubsection{Order-preserving partial transformations $\PO_n$}
\label{sec:princfact-pon}
Recall that a partial transformation $\alpha \in \PT_n$ is called
\textit{order-preserving} if, for points $i,j \in \dom\alpha$, we have
$i \leq j$ if and only if $i\alpha \leq j\alpha$.  The order-preserving partial
transformations in $\PT_n$ form a submonoid which we call $\PO_n$.

The Green's relations have the same description as in $\PT_n$, being based on
rank, image and kernel.  However, some partitions of $\bn$ do not occur as
kernels in $\PO_n$, since they cannot preserve order.  Let $P$ be a partition of
$\bn$ which contains three points $i < j < k$ such that $i$ and $k$ are in the
same kernel class, and $j$ is in a different kernel class.  Any partial
transformation $\alpha$ with kernel $P$ cannot preserve order, since it must
have either $j\alpha < i\alpha = k\alpha$ or $i\alpha = k\alpha < j\alpha$.  A
partition is a valid kernel for $\PO_n$ if and only if it observes the following
rule: a point $i$ is either in the same class as $i-1$, or it is the lowest
point in its class.  Hence, there are not $S(n+1, k+1)$ $\RR$-classes in
$D_k^n$, as there are for $\PT_n$.  The actual number of $\RR$-classes in
$D_k^n$ is given by
$$\sum_{i=k}^n \binom{n}{i} \binom{i-1}{k-1},$$
as shown in \cite[Lemma 4.1]{pon}.  This can be understood in the following way.
Since an element in $D_k^n$ has rank $k$, the domain can have any size from $k$
to $n$.  Given a domain size $i$, there are $\binom{n}{i}$ choices for the
domain.  Once we have chosen a domain, we must split the $i$ domain points into
classes.  By the above description of a valid kernel, this involves simply
choosing which $i$ of the $n$ points are the lowest in their kernel-class.
Point $1$ must be lowest, so we have $\binom{n-1}{i-1}$ choices.  The exception
to this rule is $D_0^n$, which simply has one $\RR$-class.

Idempotents have the same characterisation as for $\PT_n$.  Lemma
\ref{lem:dk-hclasses} holds for all $k$ from $0$ to $n$, as follows.  $D_0^n$ is
trivial, so both statements hold for $k=0$.  The proof given for (1) is
sufficient in this case for all $k \geq 1$.  To prove (2) for $k=1$, we use the
same approach described for $\PT_n$.  To prove (2) for $k \geq 2$, let $I_1$ and
$I_2$ be the images of $L_1$ and $L_2$ respectively; if we take the kernel
$\Delta_{I_1}$, then $I_1$ is a cross-section of it but $I_2$ is not, so the
$\RR$-class corresponding to that kernel satisfies the requirement.

Perhaps the most important difference between $\PO_n$ and $\PT_n$ is that in
$\PO_n$ a given kernel and image determines a single element, not $k!$ elements,
since order must be preserved.  This means that the underlying group of $D_k^n$
is not $\Sym_k$, but simply the trivial group $1$.  This result puts the
principal factors $\pf{D_k^n}$ into the category of \textit{congruence-free}
semigroups by Proposition \ref{prop:congruence-free}, meaning that the only
congruences on $\pf{D_k^n}$ are $\Delta$ and $\nabla$.  Indeed, the only linked
triple of $\pf{D_k^n}$ is $(1, \Delta, \Delta)$, corresponding to the trivial
congruence.  This result is summarised in Table \ref{tab:dkstar-congs-pon},
where $h_k^n$ is the number of $\HH$-classes in $D_k^n$, given by
$$\binom{n}{k} \sum_{i=k}^n \binom{n}{i} \binom{i-1}{k-1}.$$

\begin{table}[ht]
  \centering
  \renewcommand{\arraystretch}{1.3}
  \begin{tabular}{| r | r | c | r |}
    \hline
    \multicolumn{1}{|c|}{$k$}
    & \multicolumn{1}{c|}{\textbf{Congruences of $\pf{D_k^n}$}}
    & \textbf{Number}
    & \multicolumn{1}{c|}{\textbf{Number of classes}} \\
    \hline
    $0$ & $[1]$ & $1$ & $1$ \\
    $\geq 1$
    & $[1], \nabla$
    & $2$
    & $h_k^n + 1, 1$ \\
    \hline
  \end{tabular}
  \caption{Congruences of the principal factors of $\PO_n$ or
    $\POI_n$}
  \label{tab:dkstar-congs-pon}
\end{table}

\subsubsection{Order-preserving partial permutations $\POI_n$}
\label{sec:princfact-poin}
Next we consider the order-preserving partial permuations, which form the monoid
$\POI_n = \PO_n \cap \I_n$.  Like $\I_n$, the $\LL$ and $\RR$ relations are
determined by image and domain, and so Lemma \ref{lem:dk-hclasses} is proven in
the same way as for $\I_n$, and applies to all $k$ from $0$ to $n$.  Since the
kernel of a partial permutation is always a diagonal relation, we do not
encounter and kernels which cannot preserve order; hence the Green's classes of
$\POI_n$ is isomorphic to that of $\I_n$.  In particular, there are
$\binom{n}{k}^2$ $\HH$-classes in $D_k^n$.  The main difference between $\POI_n$
and $\I_n$ is that each $\HH$-class contains just one element, since each
domain--image pair defines only one order-preserving element.  Hence the
underlying group of $\pf{D_k^n}$ is the trivial group $1$, and so $\POI_n$ is
congruence-free like $\PO_n$.  This information is summarised in Table
\ref{tab:dkstar-congs-pon}, where in this case the number of $\HH$-classes
$h_k^n$ is equal to $\binom{n}{k}^2$.

\subsubsection{Order-preserving transformations $\OO_n$}
\label{sec:princfact-on}
Finally, we consider the submonoid of $\T_n$ consisting of the order-preserving
transformations, $\OO_n = \T_n \cap \PO_n$.  Since $\OO_n$ consists of
transformations, an element's kernel includes every point in $\bn$, as for
$\T_n$.  Its Green's relations $\LL$, $\RR$ and $\DD$ are again based on image,
kernel and rank, as for $\T_n$, so we do not have a $\DD$-class $D_0^n$.  Some
$\RR$-classes in $\T_n$ are not present $\OO_n$, since certain kernels cannot
preserve order: like in $\PO_n$, the valid kernels are those such that a point
$i$ either is in the same class as $i-1$, or is minimal in its class.  Hence
$D_k^n$ contains $\binom{n-1}{k-1}$ $\RR$-classes, since our only choice is
which $k-1$ of the $n-1$ points in $\bn$ are minimal, apart from $1$.  There are
still $\binom{n}{k}$ $\LL$-classes, as in $\T_n$.  Lemma \ref{lem:dk-hclasses}
applies to $\OO_n$ in the same way as it applies to $\T_n$, with statement (2)
only applying when $k > 1$.  Hence the linked triples for $k \geq 2$ have the
form $(N, \Delta, \Delta)$ while the linked triples for $k=1$ have the form
$(N, \Delta, \tT)$ for other possible values of $\tT$.

Two elements are $\HH$-related if and only if they share the same image and
kernel.  Since all elements are order-preserving, there is only one choice of
element for a given image and kernel; hence $\OO_n$ is $\HH$-trivial.  So the
only choice of $N$ for linked triples is the trivial group $1$.  Hence, when
$k \geq 2$ the only linked triple on $\pf{D_k^n}$ is $(1, \Delta, \Delta)$,
corresponding to the trivial congruence; if $k = 1$, as for $\T_n$, we have a
linked triple $(1, \Delta, \tT)$ for any relation $\tT$ on the $n$ $\LL$-classes
of $D_1^n$.  The congruences are summarised in Table \ref{tab:dkstar-congs-on},
where the number of $\HH$-classes $h_k^n$ is given by
$\binom{n}{k} \binom{n-1}{k-1}$.

\begin{table}[ht]
  \centering
  \renewcommand{\arraystretch}{1.3}
  \begin{tabular}{| r | r | c | r |}
    \hline
    \multicolumn{1}{|c|}{$k$} & \multicolumn{1}{c|}{\textbf{Congruences of $\pf{D_k^n}$}} & \textbf{Number} & \multicolumn{1}{c|}{\textbf{Number of classes}} \\
    \hline
    $1$ & $[1, \Delta_I, \mathcal{T}] (\forall \mathcal{T})$ & $B_n$ & from $1$ to $n$ \\
    $\geq 2$
    & $[1], \nabla$
    & $2$
    & $h_k^n + 1, 1$ \\
    \hline
  \end{tabular}
  \caption{Congruences of the principal factors of $\OO_n$}
  \label{tab:dkstar-congs-on}
\end{table}

\subsection{Further work}
\label{sec:princfact-further}
We have considered the monoids of partial transformations $\PT_n$,
transformations $\T_n$, and partial permutations $\I_n$, and for each of those
monoids we have considered the submonoid of order-preserving elements.  In the
future, the ideas presented here could perhaps be extended to other similar
submonoids of these three, such as the following submonoids, considered in
\cite[\S1.2]{wilf_ii}:

\begin{itemize}
\item the monoids of order-preserving \textit{or order-reversing} elements:
  $\mathcal{P\!O\!D\!}_n$, $\mathcal{O\!D\!}_n$, and $\mathcal{P\!O\!D\!I\!}_n$
  respectively;
\item the monoids of \textit{orientation}-preserving elements:
  $\mathcal{P\!O\!P\!}_n$, $\mathcal{O\!P\!}_n$, and $\mathcal{P\!O\!P\!I\!}_n$
  respectively;
\item the monoids of orientation-preserving or or orientation-reversing
  elements: $\mathcal{P\!O\!R\!}_n$, $\mathcal{O\!R\!}_n$, and
  $\mathcal{P\!O\!R\!I\!}_n$ respectively.
\end{itemize}

We could also consider some important monoids which do not consist of partial
transformations.  After the results in Chapter \ref{chap:motzkin}, it would be
interesting to learn about the congruences of the principal factors of the
Motzkin monoid and other bipartition monoids such as $\Prt_n$.  These monoids
are not as straightforward as the ones we have so far considered; certainly,
identifying the idempotents in a semigroups of bipartitions is more complicated
than for partial transformations \cite[Theorem 5]{pn_ids}.  However, it is
possible that their principal factors' congruences could be classified in a
similar way.



\section{The number of congruences of a semigroup}
\label{sec:nrcongs}

In light of the methods in Chapters \ref{chap:pairs} and \ref{chap:lattice} to
compute the congruences of a semigroup, and their implementation in
\libsemigroups{} and the \Semigroups{} package, we may be interested in the
number of congruences a given semigroup possesses.  At the very least, a
semigroup $S$ must have congruences $\Delta_S$ and $\nabla_S$, which are equal
if and only if $|S| = 1$; so any semigroup has at least one congruence.  For an
upper bound, consider that a congruence is an equivalence; the number of
equivalences on a finite set is given by the Bell numbers \citeoeis{A000110}, so
a finite semigroup $S$ cannot have more congruences than the Bell number
$B_{|S|}$.  All finite semigroups have a number of congruences between these two
bounds, but the precise number depends on the structure of the semigroup.

In this section, we consider how many congruences there are on various
semigroups, showing some computational results on small semigroups, as well as
proving some more general results.

\subsection{Congruence-free semigroups}
\label{sec:congruence-free}

The notion of a \textit{congruence-free} semigroup has long been understood, but
is presented here for completeness.  Note that any semigroup must have at least
the trivial and universal congruences $\Delta$ and $\nabla$; the definition of
a congruence-free semigroup is as follows.

\begin{definition}
  \label{def:congruence-free}
  \index{congruence-free semigroup}
  A semigroup $S$ is \textbf{congruence-free} if it has no congruences other
  than $\Delta_S$ and $\nabla_S$.
\end{definition}

By the above definition, any congruence-free semigroup has $2$ congruences,
except the trivial semigroup, which has only $1$ congruence.  Note that the
language used here differs from that used in group theory: if a group is
congruence-free (and therefore has no proper non-trivial normal subgroups) it is
called a \textit{simple group}. \index{simple!group} This is not to be confused
with the concept of a \textit{simple semigroup} (Definition
\ref{def:zerosimple}).

It is relatively easy to determine whether a finite semigroup is
congruence-free, using the following theorem based partly on material in
\cite[\S3.7]{howie}.  A full proof is included in \cite[Chapter
5]{mtorpey_pre_msc}.

\begin{proposition}
  \label{prop:congruence-free}
  A finite semigroup $S$ is congruence-free if and only if one of the following
  holds:
  \begin{enumerate}[\rm(1)]
  \item $S$ has no more than $2$ elements;
  \item $S$ is a simple group;
  \item $S$ is isomorphic to a Rees 0-matrix semigroup
    $\mathcal{M}^0[G;I,\Lambda;P]$ where $G$ is the trivial group, and $P$ is
    regular, with all its rows pairwise distinct and all its columns pairwise
    distinct.
  \end{enumerate}
\end{proposition}

\subsection{Congruence-full semigroups}
\label{sec:congruence-full}

We now define a new concept: a \textit{congruence-full} semigroup, by analogy
with the \textit{congruence-free} semigroups described in the last section.

\begin{definition}
  A semigroup $S$ is \textbf{congruence-full} if every equivalence relation on
  $S$ is a congruence.
\end{definition}

Since the number of equivalences on a finite set is given by the sequence of
Bell numbers $(B_n)_{n \in \mathbb{N}}$, we can say that a finite semigroup is
congruence-full if and only if it has precisely $B_n$ congruences, where $n$ is
the size of the semigroup.

We have already classified all the finite congruence-free semigroups in
Proposition \ref{prop:congruence-free}.
In this section we explore finite congruence-full semigroups, culminating in a
complete classification in Theorem \ref{thm:congruence-full}.  First we need to
build up some knowledge about the Green's relations of congruence-full
semigroups.

\begin{lemma}
  \label{lem:m-is-h-trivial}
  A finite congruence-full semigroup of size greater than $2$ has $\HH$-trivial
  minimal ideal.
  \begin{proof}
    Let $S$ be a finite semigroup with more than $2$ elements,
    and let $M$ be its minimal ideal.  Since $M$ is simple, every $\HH$-class of
    $M$ is a group.  We will proceed by considering possible sizes of the
    $\HH$-classes of $M$, and showing that any $\HH$-class size greater than $1$
    implies that $S$ is not congruence-full.

    Firstly, let $H$ be an $\HH$-class in $M$ with at least $3$ elements.  Let
    $1_H$ be the group identity of $H$, and let $g,h \in H\setminus\{1_H\}$ with
    $g \neq h$.  Now let $\sim$ be $(1_H, g)^e$, the equivalence whose only
    non-singleton class is $\{1_H,g\}$.  Since $g$ is not the identity, we know
    that $gh \neq h$.  Hence we have $1_H \sim g$ but $1_H h \nsim gh$, so
    $\sim$ is not a congruence.  Hence $S$ is not congruence-full.

    Instead, let $H$ be an $\HH$-class in $M$ with precisely $2$ elements.
    Since $|S| \geq 3$ we know that $S \setminus H$ is non-empty.  If there
    exists some $x \in S \setminus M$, then let $h \in H \setminus \{1_H x\}$,
    and let $\sim$ be $(x,h)^e$; since $h \neq 1_H x$ we have $x \sim h$ but
    $1_H x \nsim 1_H h$ (since $(1_Hx, 1_Hh)$ is not equal to $(x,h)$ or $(h,x)$
    and is not reflexive) so $\sim$ is not a congruence.  If on the other hand
    $S \setminus M$ is empty, then $M$ must contain an $\HH$-class other than
    $H$.  Choose some $x \in M \setminus H$ such that $x \LL 1_H$ (if this is
    not possible, we can choose $x$ such that $x \RR 1_H$, and a similar
    argument holds).  Let $h \in H \setminus \{1_H\}$, and let $\sim$ be
    $(x,1_H)^e$.  We have $xh \RR x \nRR h$, so $xh \nRR h$ and in particular
    $xh \neq h$.  Hence $x \sim 1_H$ but $xh \nsim 1_H h$, so $\sim$ is not a
    congruence.  Either of these cases shows that $S$ is not congruence-full.
  \end{proof}
\end{lemma}

\begin{lemma}
  \label{lem:m-is-l-or-r-trivial}
  A finite congruence-full semigroup of size greater than $2$ has a minimal
  ideal which is either $\LL$-trivial or $\RR$-trivial.
  \begin{proof}
    Let $S$ be a congruence-full semigroup with more than $2$ elements, with a
    minimal ideal $M$ which is neither $\LL$-trivial nor $\RR$-trivial.

    We know by Lemma \ref{lem:m-is-h-trivial} that $M$ is $\HH$-trivial.
    Since $M$ is simple and $\HH$-trivial, it is a rectangular band (see
    Definition \ref{def:rectangular-band}).  Let
    $x_{11}, x_{12}, x_{22} \in M$ be pairwise distinct elements with
    $x_{11} \RR x_{12} \LL x_{22}$, and let $\sim$ be the relation
    $(x_{11},x_{22})^e$.  Since $M$ is a rectangular band, we have
    $x_{11}x_{22} = x_{12}$ and $x_{11}x_{11} = x_{11}$.  Hence
    $x_{11} \sim x_{22}$ but $x_{11}x_{11} \nsim x_{11}x_{22}$, and so $\sim$ is
    not a congruence.  This means that $S$ is not congruence-full, a
    contradiction.
  \end{proof}
\end{lemma}

\begin{lemma}
  \label{lem:simple-or-zero-semigroup}
  A finite congruence-full semigroup of size greater than $2$ is either simple
  or a zero semigroup.
  \begin{proof}
    Let $S$ be a finite congruence-full semigroup with more than $2$ elements,
    with minimal ideal $M$.  Let us assume $S$ is not simple; this means that
    $S \setminus M$ is non-empty.  By Lemma \ref{lem:m-is-l-or-r-trivial}, $M$
    is either $\LL$-trivial or $\RR$-trivial; without loss of generality let us
    assume that $M$ is $\LL$-trivial (a similar argument applies for
    $\RR$-triviality).  We will start by proving that $S$ contains a zero, and
    then we will go on to prove that $S$ is a zero semigroup.  Firstly, aiming
    for a contradiction, let us assume that $|M| > 1$.

    If $S \setminus M$ contains an idempotent, call it $x$.  Choose $m,n \in M$
    with $m \neq n$.  Now, either $mx = m$ or $mx \neq m$.  If $mx = m$, then
    let $\sim$ be $(n,x)^e$: since by $\LL$-triviality $mn = n$, and since
    $mx = m$, we have $n \sim x$ but $mn \nsim mx$, so $\sim$ is not a
    congruence, a contradiction.  If on the other hand $mx \neq m$, then let
    $\sim$ be $(m,x)^e$: since $mx \neq x$ and $mx \neq m$ and $xx=x$, we have
    $m \sim x$ but $mx \nsim xx$, so $\sim$ is not a congruence, a
    contradiction.

    If instead, $S \setminus M$ does not contain an idempotent, then there must
    exist some $x \in S \setminus M$ such that $x^2 \in M$.
    Let $m \in M \setminus \{x^2\}$ (this is possible since $|M| > 1$) and let
    $\sim$ be $(m,x)^e$.  Since by $\LL$-triviality $xm = m$, we have $m \sim x$
    but $xm \nsim xx$, so $\sim$ is not a congruence, a contradiction.

    We have now shown that $|M| > 1$ violates the condition that $S$ is
    congruence-full.  Hence the minimal ideal $M$ must contain precisely one
    element, $0$: we have $0x = x0 = 0$ for any $x \in S$, so $0$ is a zero for
    $S$. Next we will show that $S$ is a zero semigroup, i.e.~that $xy = 0$ for
    all $x,y \in S$.  Clearly if $x$ or $y$ is $0$ then $xy = 0$.

    Let $x,y \in S \setminus \{0\}$ with $x \neq y$.  The product $xy$ cannot be
    equal to both $x$ and $y$, so without loss of generality let us assume that
    $xy \neq x$.  Assume, aiming for a contradiction, that $xy \neq 0$.  Let
    $\sim$ be the relation $(x,0)^e$; since $0y = 0$ and $xy \neq x$ we have
    $x \sim 0$ but $xy \nsim 0y$, so $\sim$ is not a congruence, a
    contradiction.  Hence for distinct $x,y \in S$ we have $xy = 0$.

    It only remains to consider whether $x^2=0$ for every $x \in S$.  Let
    $x \in S \setminus \{0\}$ and assume, aiming for a contradiction, that
    $x^2 \neq 0$.  Let $y \in S \setminus \{0,x\}$ (possible since $|S| > 2$)
    and let $\sim$ be $(x,y)^e$; since $xy=0$ but $x^2 \neq 0$, we have
    $x \sim y$ but $xx \nsim xy$, so $\sim$ is not a congruence, a
    contradiction.  Hence $xy = 0$ for all $x,y \in S$, so $S$ is a zero
    semigroup.
  \end{proof}
\end{lemma}

We can now state the main theorem of this section, a classification of all the
finite congruence-full semigroups.

\begin{theorem}
  \label{thm:congruence-full}
  A finite semigroup $S$ is congruence-full if and only if one of the following
  holds:
  \begin{enumerate}[\rm(1)]
  \item $S$ has no more than $2$ elements;
  \item $S$ is a zero semigroup;
  \item $S$ is a left zero semigroup;
  \item $S$ is a right zero semigroup.
  \end{enumerate}
  \begin{proof}
    First, observe that if $S$ has $1$ or $2$ elements, then the only
    equivalences on $S$ are $\Delta_S$ and $\nabla_S$, both of which are
    congruences; hence, $S$ is congruence-full.

    Instead, let $S$ be a finite congruence-full semigroup of size greater than
    $2$.  If $S$ is not simple, then by Lemma \ref{lem:simple-or-zero-semigroup}
    it is a zero semigroup.  If $S$ is simple, it is equal to its minimal ideal.
    Therefore, by Lemma \ref{lem:m-is-l-or-r-trivial}, $S$ is either
    $\LL$-trivial or $\RR$-trivial.  For any simple semigroup we have
    $x \RR xy \LL y$ for all $x,y \in S$.  If $S$ is $\LL$-trivial, then $xy=y$
    for all $x,y \in S$, so $S$ is a right zero semigroup.  If $S$ is
    $\RR$-trivial, then $xy=x$ for all $x,y \in S$, so $S$ is a left zero
    semigroup.

    To prove the converse, we consider zero, left zero, and right zero
    semigroups in turn.  First, let $S$ be a zero semigroup and let $\sim$ be an
    equivalence relation on $S$.  Let $x,y,s,t \in S$ such that $x \sim y$ and
    $s \sim t$.  We have $xs = 0 = yt$, so $xs \sim yt$ and therefore $\sim$ is
    a congruence.  Hence $S$ is congruence-full.

    Alternatively, let $S$ be a left zero semigroup and let $\sim$ be an
    equivalence relation on $S$.  Let $x,y,a \in S$ such that $x \sim y$.  We
    have $ax = a = ay$ and $xa = x \sim y = ya$, so $ax \sim ay$ and
    $xa \sim ya$.  Hence $\sim$ is a congruence, so $S$ is congruence-full.
    A similar argument proves the statement for right zero semigroups.
  \end{proof}
\end{theorem}

Note that some semigroups of size $2$ fall into categories (2), (3), or (4) of
the above theorem.  However, some semigroups of size 2 are not zero, left zero,
or right zero semigroups -- for example, $1^1$, the trivial group with an
identity attached -- but these are still congruence-free.  Hence all four cases
are required.



\subsection{Semigroups with fewer congruences}

If a semigroup of finite size $n$ is not congruence-full, it has fewer than
$B_n$ congruences.  If $n$ is $2$ or $3$, there exist semigroups of size $n$
with precisely $B_n - 1$ congruences.  However, for $4 \leq n \leq 7$,
computational experiments show that there is no semigroup of size $n$ with
$B_n - 1$ congruences, and it seems unlikely that such a semigroup could be
found for any higher $n$.  In this section we propose a value for the second
highest number of congruences possible on a semigroup of size $n$ -- that is, the
highest number of congruences on a semigroup that is not congruence-full.

\begin{conjecture}
  \label{conj:not-cong-full}
  A finite semigroup which is not congruence-full has at most
  $2B_{n-1}$ congruences.
\end{conjecture}

This conjecture, which does not yet have a proof, is supported by experimental
investigation.  An exhaustive analysis of all semigroups up to isomorphism and
anti-isomorphism shows that the conjecture holds for $n \leq 7$, and also
reveals a pattern in the semigroups which attain the limit.  This pattern is
stated in the next conjecture.

\begin{conjecture}
  \label{conj:cong-nearfull-7}
  Let $n > 3$.  There are precisely 7 semigroups (up to isomorphism and
  anti-isomorphism) of size $n$ which have $2B_{n-1}$ congruences.
\end{conjecture}

The seven semigroups are shown and described in Figures \ref{fig:nearfull-1} to
\ref{fig:nearfull-7}, including diagrams for $n = 4$.  In the descriptions, when
the zero semigroup with $n-1$ elements $\Z_{n-1}$ is a subsemigroup of $S$, the
zero of $\Z_{n-1}$ is called $z$.  \nomenclature[Zn]{$\Z_n$}{Left zero
  semigroup}

\begin{figure}[p]
  \centering
  \includesvg{pics/ch-other/lz-plus-id}
  \caption[Nearly congruence-full semigroup 1]{Nearly congruence-full semigroup
    1.  Left-zero semigroup $\LZ_{n-1}$ with an idempotent $c$ appended.  There
    is a distinguished $p \in M$ such that $cx=p$ and $xc=x$ for all $x \in M$}
  \label{fig:nearfull-1}
\end{figure}

\begin{figure}[p]
  \centering
  \includesvg{pics/ch-other/lz-plus-nonid}
  \caption[Nearly congruence-full semigroup 2]{Nearly congruence-full semigroup
    2.  Left-zero semigroup $\LZ_{n-1}$ with a non-idempotent element $c$
    appended.  Multiplication defined by $cx=c^2$ and $xc=x$ for all $x \in M$}
  \label{fig:nearfull-2}
\end{figure}

\begin{figure}[p]
  \centering
  \includesvg{pics/ch-other/z-plus-zero}
  \caption[Nearly congruence-full semigroup 3]{Nearly congruence-full semigroup
    3.  Zero semigroup $\Z_{n-1}$ with a zero appended}
  \label{fig:nearfull-3}
\end{figure}

\begin{figure}[p]
  \centering
  \includesvg{pics/ch-other/z-plus-id}
  \caption[Nearly congruence-full semigroup 4]{Nearly congruence-full semigroup
    4.  Zero semigroup $\Z_{n-1}$ with an idempotent $c$ appended above the
    minimal ideal.  Multiplication defined by $cx=xc=z$ for all
    $x \in \Z_{n-1}$}
  \label{fig:nearfull-4}
\end{figure}

\begin{figure}[p]
  \centering
  \includesvg{pics/ch-other/z-plus-m-id}
  \caption[Nearly congruence-full semigroup 5]{Nearly congruence-full semigroup
    5.  Zero semigroup $\Z_{n-1}$ with an idempotent $c$ appended in the minimal
    ideal.  Multiplication defined by $cx=c$ and $xc=z$ for all
    $x \in \Z_{n-1}$}
  \label{fig:nearfull-5}
\end{figure}

\begin{figure}[p]
  \centering
  \includesvg{pics/ch-other/c2-plus-nonids}
  \caption[Nearly congruence-full semigroup 6]{Nearly congruence-full semigroup
    6.  Zero semigroup $\Z_{n-1}$ with an element $c$ appended in the same
    $\HH$-class as $z$ so that $\{z,c\} \cong \Cyc_2$.  Multiplication defined
    by $c^2=z$ and $xc=cx=c$ for all $x \in \Z_{n-1}$}
  \label{fig:nearfull-6}
\end{figure}

\begin{figure}[p]
  \centering
  \includesvg{pics/ch-other/c2-plus-nonids}
  \caption[Nearly congruence-full semigroup 7]{Nearly congruence-full semigroup
    7.  Cyclic group $\Cyc_2 = \{\id, g\}$ with $n-2$ elements appended such
    that $xy=\id$, $x \id=\id x=g$ (for all $x,y \in S \setminus \Cyc_2$)}
  \label{fig:nearfull-7}
\end{figure}

Of the seven semigroups shown, each of the first 6 contain a copy of either the zero
semigroup $\Z_{n-1}$ or the left zero semigroup $\LZ_{n-1}$ as a subsemigroup.
\nomenclature[LZn]{$\LZ_n$}{Left zero semigroup}
The one element outside this subsemigroup, which we will call $c$ (the
\textit{child element}) is key to understanding why these semigroups have
$2B_{n-1}$ congruences.  In each semigroup, there is another element $p$ (the
\textit{parent element}) such that an equivalence $\sim$ is a congruence if and
only if $c \sim p$ or $[c]_\sim$ is a singleton.  In other words, the child has
to be alone or with its parent.  Now, since $S \setminus \{c\}$ is
congruence-full, we can take any congruence (any equivalence) $\sim$ on
$S \setminus \{c\}$ and extend it to a congruence on $S$ in two different ways:
by including $c$ as a singleton, or by including $c$ in the same congruence
class as $p$.  Since there are $B_{n-1}$ choices for $\sim$, this gives us
precisely $2B_{n-1}$ congruences on $S$.

The seventh semigroup (Figure \ref{fig:nearfull-7}) is unique in that it does
not contain $\Z_{n-1}$ or $\LZ_{n-1}$ as a subsemigroup.  However, it still
fulfils the \textit{child--parent} condition above, where $c = \id$ and $p = g$.

Conjecture \ref{conj:cong-nearfull-7} does not have a proof, and it is certainly
possible that there may be more than just these seven semigroups when $n > 7$.
However, the statement is certainly true for sizes 4, 5, 6 and 7, so it seems
likely that the pattern may continue.  The feasibility of computational
experiments for higher values of $n$ is discussed at the end of Section
\ref{sec:smallsemi}.

\section{Small semigroups}
\label{sec:smallsemi}
The \smallsemi{} package \cite{smallsemi} provides a library of all the
semigroups of size no more than $8$, up to isomorphism and anti-isomorphism.
Using this library, it was possible to calculate the congruences of all
$853303$ semigroups of size no more than $7$, revealing some interesting
information about the numbers of congruences of the semigroups, as well as about
the properties of those semigroups.  Some of these findings are presented here.

The average number of congruences on a semigroup of size $n$ is shown in Table
\ref{tab:nr-congs-smallsemi}.  Since we only have the first few values here, it
is hard to make a conjecture about the growth of this sequence.  However, it
appears to increase rapidly, as might be expected for a value with upper bound
given by the Bell numbers (see Section \ref{sec:congruence-full}).

\begin{table}[ht]
  \centering
  \renewcommand{\arraystretch}{1.3}
  \begin{tabular}{| r | r |}
    \hline
    \multicolumn{1}{|c|}{$n$}
    & \mc{1}{c|}{Average number}
    \\ \hline
    1 &    1.00 \\
    2 &    2.00 \\
    3 &    3.67 \\
    4 &    6.44 \\
    5 &   11.44 \\
    6 &   23.05 \\
    7 &   78.42 \\
    \hline
  \end{tabular}
  \caption{Average number of congruences on a semigroup of size $n$}
  \label{tab:nr-congs-smallsemi}
\end{table}

It is perhaps surprising to see how many congruences on small semigroups are
principal (i.e.~generated by a single pair).  Table \ref{tab:nr-principal-congs}
shows, for each size $n$, the average proportion of a semigroup's congruences
which are principal.  As can be seen, this proportion is very high for small
semigroups, but declines greatly as we increase the size, reaching $29\%$ for an
average semigroup of size $7$.  Also shown is the number of semigroups whose
congruences are all principal, a number which also decreases rapidly.

\begin{table}[ht]
  \centering
  \renewcommand{\arraystretch}{1.3}
  \begin{tabular}{| r | r | >{\phantom{mmm}}r>{\!\!\!\!\!} l | c |}
    \hline
    \multicolumn{1}{|c|}{$n$}
    & \multicolumn{1}{c|}{Semigroups}
    & \mc{2}{p{3.5cm}|}{Semigroups with just principal congruences}
    & \mc{1}{p{3.5cm}|}{Average proportion of principal congruences}
    \\ \hline
    1 &      1 &   1 & (100\%)   & 100\% \\
    2 &      4 &   4 & (100\%)   & 100\% \\
    3 &     18 &  16 & (89\%)    &  98\% \\
    4 &    126 &  56 & (44\%)    &  90\% \\
    5 &   1160 & 122 & (11\%)    &  77\% \\
    6 &  15973 & 198 & (1.2\%)   &  60\% \\
    7 & 836021 & 320 & (0.038\%) &  29\% \\
    \hline
  \end{tabular}
  \caption[Number of principal congruences on semigroups of size $n$]
  {Number of principal congruences on semigroups of size $n$.  The first column
    is a size $n$; the second column is the number of semigroups of this size up
    to isomorphism and anti-isomorphism; the third column is the number of these
    semigroups that have only principal congruences; and the final column is the
    percentage of a semigroup's congruences that are principal, on average}
  \label{tab:nr-principal-congs}
\end{table}

The number of principal congruences compares curiously to the number of Rees
congruences (see Section \ref{sec:converting-rees}): Table
\ref{tab:nr-rees-congs} shows the proportion of congruences that are Rees on an
average semigroup of size $n$, as well as the number of semigroups whose
congruences are all Rees.  For $n$ from $2$ to $6$, there are fewer Rees
congruences than principal congruences, but when $n=7$ there are slightly more
Rees than principal; indeed, when $n=7$ there are nearly twice as many
semigroups with all Rees congruences as all principal congruences.  This may
indicate that the proportion of principal congruences decreases faster than the rate
of Rees congruences, as $n$ grows; however, with only the first $7$ values, it
is difficult to reach any reliable conclusions.

\begin{table}[ht]
  \centering
  \renewcommand{\arraystretch}{1.3}
  \begin{tabular}{| r | r | >{\phantom{mmm}}r>{\!\!\!\!\!} l | c |}
    \hline
    \multicolumn{1}{|c|}{$n$}
    & \multicolumn{1}{c|}{Semigroups}
    & \mc{2}{p{3.5cm}|}{Semigroups with just Rees congruences}
    & \mc{1}{p{3.5cm}|}{Average proportion of Rees congruences}
    \\ \hline
    1 &      1 &   1 & (100\%)   & 100\% \\
    2 &      4 &   2 & (50\%)    &  75\% \\
    3 &     18 &   5 & (28\%)    &  69\% \\
    4 &    126 &  13 & (10\%)    &  59\% \\
    5 &   1160 &  46 & (4.0\%)   &  51\% \\
    6 &  15973 & 157 & (0.98\%)  &  42\% \\
    7 & 836021 & 623 & (0.075\%) &  31\% \\
    \hline
  \end{tabular}
  \caption[Number of Rees congruences on semigroups of size $n$]
  {Number of Rees congruences on semigroups of size $n$.  The first column is a
    size $n$; the second column is the number of semigroups of this size up to
    isomorphism and anti-isomorphism; the third column is the number of these
    semigroups that have only Rees congruences; and the final column is the
    percentage of a semigroup's congruences that are Rees, on average}
  \label{tab:nr-rees-congs}
\end{table}

There are 1,843,120,128 semigroups of size 8, more than 2000 times as many as
there are semigroups of size 1 to 7.  It would require a very long time to
compute all the congruences of all these semigroups on current hardware, with
the algorithms and implementations that have been described.  However, it would
be possible to calculate the congruences given enough time, particularly using a
very fast computer -- and since each semigroup is processed independently, it
would also be trivial to split the task between multiple computers to speed up
the process.  It would be interesting to examine the congruences on all the
semigroups of size 8, firstly to see how the trends in Tables
\ref{tab:nr-congs-smallsemi}, \ref{tab:nr-principal-congs} and
\ref{tab:nr-rees-congs} continue, but also to test Conjectures
\ref{conj:not-cong-full} and \ref{conj:cong-nearfull-7}.

There are 52,989,400,714,478 semigroups of size 9 \cite{order_nine}, a huge
number.  No computational library of all these semigroups currently exists, and
if one did, it is likely that it would take an unreasonably long time to compute
all their congruences with anything like the algorithms described in this
thesis.  A more feasible area of future work would be to consider the
congruences of all small simple or 0-simple semigroups, or of all small inverse
semigroups.  Analysing these categories might reveal interesting trends distinct
from those in the generic case.

It is worth mentioning that, up to isomorphism and anti-isomorphism, almost all
semigroups are \textit{$3$-nilpotent} -- that is, they contain a zero, and any
product of three elements is equal to zero.  In \cite{kleitman_1976} a
construction is given which allows us to enumerate all $3$-nilpotent semigroups,
and in \cite[\S2.3]{distler_thesis} this is used to produce a formula for the
number of $3$-nilpotent semigroups up to isomorphism and anti-isomorphism.  As
$n$ increases, the proportion of semigroups that are $3$-nilpotent increases,
until at $n=9$ they account for over $99.9\%$ of all the semigroups of size $n$.
Hence, the trends shown in Tables \ref{tab:nr-congs-smallsemi},
\ref{tab:nr-principal-congs} and \ref{tab:nr-rees-congs} become increasingly
dominated by $3$-nilpotent semigroups, and so anything we can say about a
congruence on a $3$-nilpotent semigroup could help explain the patterns we see.
So far, little has been written about the congruences on a $3$-nilpotent
semigroup, but in the future it might be possible to develop a new
representation for congruences on $3$-nilpotent semigroups, akin to those
described in Section \ref{sec:ways-of-representing}.  Such a representation
could make it possible to compute a close approximation to the number of
congruences, Rees congruences, and principal congruences on an average semigroup
of size $n$ without having to consider every semigroup in turn.  This would be
desirable, since it would allow us to extend the tables to higher values of $n$.
