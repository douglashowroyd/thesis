\chapter{Congruences of principal factors}
\label{chap:princfact}

\section{$\mathcal{T}_n$}
The \textit{full transformation monoid} $\mathcal{T}_n$ is the semigroup consisting of all
transformations on the set $\{1 \dots n\}$, for some $n \in \mathbb{N}$.  Its
Green's relation structure is well-understood: for two mappings $\alpha, \beta
\in \mathcal{T}_n$,

\begin{itemize}
\item $\alpha \LL \beta$ if and only if $\im \alpha = \im \beta$,
\item $\alpha \RR \beta$ if and only if $\ker \alpha = \ker \beta$,\cite[9.2]{ruskuc-notes}
\item $\alpha \DD \beta$ if and only if $\rank \alpha = \rank \beta$.\cite[10.6]{ruskuc-notes}
\end{itemize}

This last allows us to name the semigroup's $\DD$-classes $D_1, D_2,
\dots, D_n$, where each $D_k$ is the $\DD$-class consisting of
transformations with rank $k$.  The usual partial ordering of
$\JJ$-classes \cite[p.47]{howie} (which in a finite semigroup are the
same as $\DD$-classes) gives $D_1 < D_2 < \dots < D_n$.

Inside a given $\DD$-class $D_k$, elements are divided into
$\LL$-classes according to their image set; since all elements have rank
$k$, their images must have size $k$, and so there are $\binom{n}{k}$
$\LL$-classes in total.  Similarly, the elements of $D_k$ are divided
into $\RR$-classes according to their kernel; there is one class for
each possible $k$-partition of an $n$-set, so there are the Stirling number of
the second kind, $S(n,k)$ $\RR$-classes in total.

Each $\HH$-class in $D_k$ is the intersection of an $\LL$-class
and an $\RR$-class, so each one corresponds to an image-kernel pair
(hence we will talk about the \textit{image} and \textit{kernel of an $\HH$-class}).
For a given kernel with $k$ classes and a given image with $k$ elements, there
are $k!$ different ways to assign image elements to kernel classes, simply the
permutations of $\{1 \dots k\}$.  Hence there are $k!$ elements in each
$\HH$-class.

\subsection{Group $\HH$-classes}
\label{sec:grouphclasses}
To determine which $\HH$-classes of $D_k$ are groups, we recall that in any
semigroup an $\HH$-class H is a group if and only if it contains an idempotent
($\alpha \alpha = \alpha$).  A transformation $\alpha \in \mathcal{T}_n$ is an idempotent
if and only if each point in its image is mapped by $\alpha$ to itself:
$$i \alpha = i \quad (\forall i \in \im \alpha)$$
Given an image and a kernel, we can choose a transformation with the condition
above if and only if no pair of points in the image are in the same
kernel-class, i.e.~each image point is in a different kernel-class.
Hence an $\HH$-class of $D_k$ is a group if and only if its image is a transversal
of its kernel.

\begin{lemma}
\label{lem:hclasses}
\leavevmode
  \begin{enumerate}
  \item For any two distinct $\LL$-classes $L_1$ and $L_2$ of $D_k$ (for
    $1 < k \leq n$) there is an $\RR$-class $R$ such that $L_1 \cap R$
    is a group $\HH$-class, but $L_2 \cap R$ is not.
  \item For any two distinct $\RR$-classes $R_1$ and $R_2$ of $D_k$ (for
    $1 \leq k \leq n$) there is an $\LL$-class $L$ such that $L \cap
    R_1$ is a group $\HH$-class, but $L \cap R_2$ is not.
  \end{enumerate}
  \begin{proof}
    \leavevmode
    \begin{enumerate}
    \item Let $L_1$ and $L_2$ be distinct $\LL$-classes of $D_k$, with
      $1 < k \leq n$.  These two classes correspond to distinct images of size
      $k$ in $\{1 \dots n\}$; let us call these images $I_1$ and $I_2$
      respectively.  w.l.o.g. let $I_1 = \{1, 2, \dots, k\}$.  Since $I_1 \neq
      I_2$, there must be an element $i \in \{1 \dots k\}$ not in $I_2$.  Now
      consider the $k$-partition $P$ which puts each element from $\{1 \dots
      k\}$ in a class on its own, apart from one element $j \in \{1 \dots k\}$
      not equal to $i$, which is in a class with all the elements $\{k+1 \dots
      n\}$ (choosing $j \neq i$ requires $k > 1$).  Now $I_1$ is a transversal
      of $P$, having precisely one element from each class; but $I_2$ does not
      have an element from the class $\{i\}$, and so it is not a transversal of
      $P$.  Let $R$ be the $\RR$-class with kernel $P$, and we have that
      $L_1 \cap R$ is a group $\HH$-class but $L_2 \cap R$ is not.

    \item Let $R_1$ and $R_2$ be distinct $\RR$-classes of $D_k$.  These two classes
      correspond to distinct kernels $P_1$ and $P_2$, each partitioning $\{1,
      \dots, n\}$ into $k$ classes.  If $k=n$ then there is only one possible
      partition, $\big\{\{1\}, \dots, \{n\}\big\}$, and so $R_1$ and $R_2$
      cannot be distinct.  If $k<n$ then there must be a pair of elements $i,j \in
      \{1,\dots, n\}$ which are in different classes of $P_1$ but the same class
      of $P_2$.  Let $X$ be a $k$-set containing one element from each class of
      $P_1$, including $i$ and $j$ -- clearly it is a transversal of $P_1$.  But
      now $X$ contains two elements from one class of $P_2$, so it is not a
      transversal of $P_2$.  Hence, if $L$ is the $\LL$-class corresponding to image
      $X$, $L \cap R_1$ is a group $\HH$-class but $L \cap R_2$ is not a group
      $\HH$-class.
    \end{enumerate}
  \end{proof}
\end{lemma}

\subsection{Principal Factors}
\label{sec:principal}

\begin{definition}
\label{def:principalfactor}
The \textbf{principal factor} $D_k^*$ of a $\DD$-class $D_k$ is the Rees
0-matrix semigroup $\mathcal{M}^0[G;I,\Lambda;P]$ isomorphic to the set $D_k \cup
\{0\}$, with multiplication $*$ given by
$$s * t = \left\{
  \begin{array}{l l}
    st & \text{if~} s,t,st \in D_k, \\
    0 & \text{otherwise}.
  \end{array}\right.$$
\end{definition}

The principal factor of a $\DD$-class must always be a 0-simple
semigroup, and so we can use \textit{linked triples} to classify its
congruences.\cite[3.5]{howie}

Let $D_k^* = \mathcal{M}^0[G;I,\Lambda;P]$ as above.
The rows and columns of the matrix $P$ correspond respectively to the $\LL$-classes and
$\RR$-classes of $D_k$, and $G$ is the group isomorphic to each of $D_k$'s group
$\HH$-classes.  Since the elements of an $\HH$-class here correspond to all the permutations
of its image (all the different ways to assign the $k$ image points to the $k$
classes of the kernel) this group is isomorphic to the symmetric group $S_k$.

To consider the congruences of $D_k^*$, we first recognise the universal
congruence $D_k^* \times D_k^*$.  All the other congruences are in bijective
correspondence with $D_k^*$'s linked triples $(N,\mathcal{S},\mathcal{T})$, as
follows.

\begin{definition}
  \label{def:linkedtriple}
  For a finite 0-simple Rees 0-matrix semigroup
  $\mathcal{M}^0[G;I,\Lambda;P]$, a \textbf{linked triple} is a
  triple $$(N,\mathcal{S},\mathcal{T})$$ consisting of a normal subgroup $N
  \trianglelefteq G$, an equivalence relation $\mathcal{S}$ on $I$ and an
  equivalence relation $\mathcal{T}$ on $\Lambda$, such that the following are
  satisfied:
  \begin{enumerate}
  \item $\mathcal{S} \subseteq \varepsilon_I$, where $\varepsilon_I =
    \left\{(i,j) \in I \times I\, \middle|\, \forall \lambda \in \Lambda:
      p_{\lambda i}=0 \iff p_{\lambda j}=0 \right\}$,
  \item $\mathcal{T} \subseteq \varepsilon_\Lambda$, where $\varepsilon_\Lambda
    = \left\{(\lambda,\mu) \in \Lambda \times \Lambda\, \middle|\, \forall i \in
      I: p_{\lambda i}=0 \iff p_{\mu i}=0 \right\}$,
  \item For all $i,j \in I$ and $\lambda, \mu \in \Lambda$ such that
    $p_{\lambda i}, p_{\lambda j}, p_{\mu i}, p_{\mu j} \neq 0$ and either
    $(i,j) \in \mathcal{S}$ or $(\lambda,\mu) \in \mathcal{T}$, we have
    that $q_{\lambda \mu i j} \in N$, where $$q_{\lambda \mu i j} = p_{\lambda
      i} p_{\mu i}^{-1} p_{\mu j} p_{\lambda j}^{-1}.$$
  \end{enumerate}
  \cite[p.86]{howie}
\end{definition}

We shall first find all the triples which satisfy conditions (1) and (2), and
then we shall show that in this case all of them satisfy condition (3).

First, recall that an element $p_{\lambda i}$ is non-zero if and only if the
corresponding $\HH$-class is a group.  By Lemma \ref{lem:hclasses} we can see that
for any pair of columns $i,j \in I$ there exists a row $\lambda \in \Lambda$
such that $p_{\lambda i} \neq 0 = p_{\lambda j}$.  Hence $\varepsilon_I =
\Delta_I$.  Similarly, in the limited case that $k>1$, Lemma \ref{lem:hclasses}
gives us that for any pair of rows $\lambda, \mu \in \Lambda$ there exists a
column $i \in I$ such that $p_{\lambda i} \neq 0 = p_{\mu i}$.  Hence if $k>1$
then we have $\varepsilon_\Lambda = \Delta_\Lambda$.

\subsubsection{Linked Triples for $k = 1$}
\label{sec:k1}
First let us consider the linked triples of $D_1^*$.  Since this $\DD$-class
consists of the transformations with rank $1$, there are $n$ possible images
$$\{1\}, \{2\}, \dots, \{n\}$$ and only one possible kernel
$$\big\{\{1 \dots n\}\big\}.$$
Hence the matrix $P$ of $D_1^*$ has $n$ rows and $1$ column.  Every element in
$D_1$ has the form
$$\begin{pmatrix}
  1 & 2 & \cdots & n \\
  i & i & \cdots & i
\end{pmatrix}$$ for some $i \in \{1 \dots n\}$, so each element is an idempotent
in its own $\HH$-class.  Hence each $\HH$-class is a group, so the matrix $P$ has no
zeroes, and $\varepsilon_\Lambda = \Lambda \times \Lambda$.  The underlying
group $G$ of the Rees 0-matrix semigroup $D_1^*$ must be trivial, since each
$\HH$-class contains just one element.

Taking all this information together, we can classify all the triples $(N,
\mathcal{S}, \mathcal{T})$ which satisfy conditions (1) and (2) as follows:
\begin{itemize}
\item $N$ must be a normal subgroup of the trivial group.  Hence $N = 1$.
\item $\mathcal{S}$ must be a subset of the trivial relation $\Delta_I$.  Hence
  $\mathcal{S} = \Delta_I$.
\item $\mathcal{T}$ may be any subset of $\Lambda \times \Lambda$.
\end{itemize}
This gives us all triples of the form $(1,\Delta_I,\mathcal{T})$, where
$\mathcal{T}$ can be any partition of the $n$ rows in $\Lambda$.  The number of
these triples is the Bell number $B_n$.  Now consider condition (3): since the
underlying group of $D_1^*$ is trivial, and our chosen normal subgroup $N$ is
also trivial, we have that any four nonzero elements from the matrix $P$ must
multiply together to give the identity $1$, which will always be in $N$.  Hence all the
triples described are \textit{linked}, and there are $B_n$ of them.

\subsubsection{Linked Triples for $k \geq 2$}
\label{sec:k2}
Now let us consider the linked triples of $D_k^*$ for $k \geq 2$.  We already
know that $\varepsilon_I = \Delta_I$ and $\varepsilon_\Lambda = \Delta_\Lambda$,
so any triple satisfying conditions (1) and (2) must have the form
$$(N, \Delta_I, \Delta_\Lambda)$$
with freedom only in the choice of a normal subgroup $N$ of $G$.  We may write
this simply as $(N, \Delta, \Delta)$ for brevity.  This
underlying group $G$ is, as stated above, isomorphic to the symmetric group
$S_k$, so $N$ can be chosen to be any normal subgroup of $S_k$.

The only normal subgroups of $S_k$ for $k=3$ and $k \geq 5$ are the trivial group, the
alternating group $A_k$, and the symmetric group $S_k$ itself.  For $k=2$ we
have $1 = A_2 < S_2$, and for $k=4$ alone we must add a fourth normal subgroup,
$V_4 = \langle (1~2)(3~4), (1~3)(2~4) \rangle$.

To see that all these triples also fulfil condition (3) we use the triviality of
the relations $\mathcal{S} = \Delta_I$ and $\mathcal{T} = \Delta_\Lambda$.
Observe that $(i,j) \in \mathcal{S}$ only if $i = j$, and $(\lambda,\mu) \in
\mathcal{T}$ only if $\lambda = \mu$.  In the former case, we have
$$q_{\lambda \mu i j} = p_{\lambda i} (p_{\mu i}^{-1} p_{\mu i}) p_{\lambda
  i}^{-1} = p_{\lambda i} p_{\lambda i}^{-1} = 1 \in N,$$
and in the latter case,
$$q_{\lambda \mu i j} = (p_{\lambda i} p_{\lambda i}^{-1}) (p_{\lambda j}
p_{\lambda j}^{-1}) = 1 \cdot 1 = 1 \in N.$$ Hence condition (3) is fulfilled
and all of the triples described are \textit{linked}.

\subsection{Numbers of Congruence Classes}
\label{sec:nrclasses}
The universal congruence $D_k^* \times D_k^*$ has, by definition, one congruence
class.  Any other congruence on a principal factor has a linked triple
$(N,\mathcal{S},\mathcal{T})$, and we can use this triple to calculate the
number of congruence classes.  Each non-zero class corresponds to a triple
$(Nx,i\mathcal{S},\lambda\mathcal{T})$ of a coset of $N$, a class of
$\mathcal{S}$ and a class of $\mathcal{T}$.  Hence the total number of classes
is equal to
$$|G:N| \cdot |I/\mathcal{S}| \cdot |\Lambda/\mathcal{T}| + 1.$$

\subsection{Summary of Results}
\label{sec:summary}
We can now describe all the congruences of the principal factors $D_k^*$ of the
full transformation monoid $\mathcal{T}_n$.  If $(N,\mathcal{S},\mathcal{T})$ is a linked
triple on $D_k^*$, then let $[N,\mathcal{S},\mathcal{T}]$ be the non-universal
congruence associated with that triple.
For brevity, let $[N] = [N, \Delta_I, \Delta_\Lambda]$ and
let $u_n = \binom{n}{k} \cdot S(n,k)$, the number of
$\HH$-classes in $D_k$.

\begin{theorem}
The congruences of $D_k^*$ are as follows.
\\ \\
% \begin{table}[h]
%   \centering
  \begin{tabular}{| r | r | c | r |}
    \hline
    \multicolumn{1}{|c|}{$k$} & \multicolumn{1}{|c|}{\textbf{Congruences of $D_k^*$}} & \textbf{Number} & \multicolumn{1}{|c|}{\textbf{Number of classes}} \\
    \hline
    $1$ & $[1, \Delta_I, \mathcal{T}] (\forall \mathcal{T}), D_1^* \times D_1^*$ & $B_n + 1$
    & $|\Lambda/\mathcal{T}|+1$, $1$ \\
    $2$ & $[1], [S_2], D_2^* \times D_2^*$ & $3$ & $2u_2+1, u_2+1, 1$ \\
    $3$ & $[1], [A_3], [S_3], D_3^* \times D_3^*$ & $4$ & $6u_3+1, 2u_3+1, u_3+1, 1$ \\
    $4$ & $[1], [V_4], [A_4], [S_4], D_4^* \times D_4^*$ & $5$ & $24u_4+1, 6u_4+1, 2u_4+1, u_4+1, 1$ \\
    $\geq 5$ & $[1], [A_k], [S_k], D_k^* \times D_k^*$ & $4$ & $k!u_k+1, 2u_k+1, u_k+1, 1$ \\
    \hline
  \end{tabular}
% \end{table}
\end{theorem}

Note that some alternative definitions of $D_k^*$ include a zero element only
when ``necessary'', i.e.~only when there exist two elements in $D_k$ which multiply together to
give an element not in $D_k$.  If this definition is preferred (as in the
Semigroups package\cite{semigroups} of the GAP computational algebra
system\cite{gap}) there will be no zero element in $D_1^*$ or $D_n^*$, so the
additional universal congruence in the preceding summary should be removed in
those two cases, and the number of congruences adjusted down by $1$.

We can now summarise the numbers of congruence classes for some small values of
$n$.  The following table gives the number of classes of each congruence on each
principal factor $D_k^*$ of $\mathcal{T}_n$, for $n$ up to $7$.  Note that for $k=1$ only
the set of distinct values has been given, since there are $B_n+1$ different
congruences which must be considered.

\begin{table}[h]
  \centering
  \begin{tabular}{|r|r|r|r|r|r|r|r|r|}
    \hline
    & $n=1$ & $n=2$ & $n=3$ & $n=4$ & $n=5$ \\ \hline
    $k=1$ & $\{1, 2\}$ & $\{1\dots 3\}$ & $\{1\dots 4\}$ & $\{1\dots 5\}$ & $\{1\dots 6\}$ \\
    $k=2$ & - & 3, 2, 1 & 19, 10, 1 & 85, 43, 1 & 301, 151, 1 \\
    $k=3$ & - & - & 7, 3, 2, 1 & 145, 49, 25, 1 & 1501, 501, 251, 1 \\
    $k=4$ & - & - & - & 25, 7, 3, 2, 1 & 1201, 301, 101, 51, 1 \\
    $k=5$ & - & - & - & - & 121, 3, 2, 1 \\
    \hline
  \end{tabular}
\end{table}

\begin{table}[h]
  \centering
  \begin{tabular}{|r|r|r|}
    \hline
    & $n=6$ & $n=7$ \\ \hline
    $k=1$ & $\{1\dots 7\}$ & $\{1\dots 8\}$ \\
    $k=2$ & 931, 466, 1 & 2647, 1324, 1 \\
    $k=3$ & 10801, 3601, 1801, 1 & 63211, 21071, 10536, 1 \\
    $k=4$ & 23401, 5851, 1951, 976, 1 & 294001, 73501, 24501, 12251, 1 \\
    $k=5$ & 10801, 181, 91, 1 & 352801, 5881, 2941, 1 \\
    $k=6$ & 721, 3, 2, 1 & 105841, 295, 148, 1 \\
    $k=7$ & - & 5041, 3, 2, 1 \\
    \hline
  \end{tabular}
\end{table}

\section{$\mathcal{PT}_n$}
\label{sec:ptn}

\section{$\mathcal{O}_n$}
\label{sec:on}

\section{$\mathcal{POR}_n$}
\label{sec:porn}

\section{Probably some others}
